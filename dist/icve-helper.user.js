// ==UserScript==
// @name         Êô∫ÊÖßËÅåÊïôÂÖ®ËÉΩÂä©Êâã
// @namespace    http://tampermonkey.net/
// @version      1.5.0
// @author       caokun
// @description  Êô∫ÊÖßËÅåÊïôMOOCÂ≠¶‰π†Âä©ÊâãÔºö‰ªÖÊîØÊåÅÊô∫ÊÖßËÅåÊïôMOOCÂπ≥Âè∞ÔºåÈõÜÊàêËá™Âä®Â≠¶‰π†ÂíåAIÊô∫ËÉΩÁ≠îÈ¢òÂäüËÉΩ
// @license      MIT
// @icon         https://www.icve.com.cn/favicon.ico
// @homepageURL  https://github.com/hearthealt/Smart-Vocational-Education
// @supportURL   https://github.com/hearthealt/Smart-Vocational-Education/issues
// @downloadURL  https://raw.githubusercontent.com/hearthealt/Smart-Vocational-Education/master/dist/icve-helper.user.js
// @updateURL    https://raw.githubusercontent.com/hearthealt/Smart-Vocational-Education/master/dist/icve-helper.user.js
// @match        https://*.icve.com.cn/excellent-study/*
// @match        https://*.icve.com.cn/preview-exam/*
// @connect      *
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @run-at       document-idle
// ==/UserScript==

(function () {
  'use strict';

  const Utils = {
    // Âª∂Êó∂ÂáΩÊï∞
    sleep: (ms) => new Promise((resolve) => setTimeout(resolve, ms)),
    // Ê†ºÂºèÂåñÊó∂Èó¥ÔºàÁßíËΩ¨‰∏∫ MM:SS Ê†ºÂºèÔºâ
    formatTime: (seconds) => {
      if (!seconds || isNaN(seconds) || seconds === Infinity) return "0:00";
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, "0")}`;
    },
    // Èò≤ÊäñÂáΩÊï∞
    debounce: (fn, delay = 300) => {
      let timer = null;
      return function(...args) {
        if (timer) clearTimeout(timer);
        timer = setTimeout(() => fn.apply(this, args), delay);
      };
    },
    // ËäÇÊµÅÂáΩÊï∞
    throttle: (fn, delay = 300) => {
      let lastTime = 0;
      return function(...args) {
        const now = Date.now();
        if (now - lastTime >= delay) {
          lastTime = now;
          return fn.apply(this, args);
        }
      };
    },
    // ÂÆâÂÖ®Ëé∑ÂèñDOMÂÖÉÁ¥†
    $(selector, parent = document) {
      return parent.querySelector(selector);
    },
    // ÂÆâÂÖ®Ëé∑ÂèñÂ§ö‰∏™DOMÂÖÉÁ¥†
    $$(selector, parent = document) {
      return Array.from(parent.querySelectorAll(selector));
    },
    // Â∏¶ÈáçËØïÁöÑÂºÇÊ≠•Êìç‰Ωú
    async retry(fn, maxRetries = 3, delay = 1e3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          return await fn();
        } catch (error) {
          if (i === maxRetries - 1) throw error;
          await this.sleep(delay);
        }
      }
    }
  };
  const Logger = {
    _prefix: "[Êô∫ÊÖßËÅåÊïôÂä©Êâã]",
    _maxLogs: 100,
    // ÊúÄÂ§ßÊó•ÂøóÊù°Êï∞
    _logs: [],
    // Â≠òÂÇ®Êó•ÂøóÊï∞ÊçÆ
    _log(level, ...args) {
      const timestamp = (/* @__PURE__ */ new Date()).toLocaleTimeString();
      this._addPageLog(level, timestamp, args);
    },
    _addPageLog(level, timestamp, args) {
      const message = args.map(
        (arg) => typeof arg === "object" ? JSON.stringify(arg) : String(arg)
      ).join(" ");
      const logEntry = {
        level,
        timestamp,
        message,
        id: Date.now() + Math.random()
      };
      this._logs.push(logEntry);
      if (this._logs.length > this._maxLogs) {
        this._logs.shift();
      }
      this._updatePageLog(logEntry);
      if (typeof updateLogCount === "function") {
        updateLogCount();
      }
    },
    _updatePageLog(logEntry) {
      const container = document.getElementById("page-log-container");
      if (!container) return;
      const placeholder = container.querySelector(".log-placeholder");
      if (placeholder) {
        placeholder.remove();
      }
      const logElement = this._createLogElement(logEntry);
      container.appendChild(logElement);
      while (container.children.length > this._maxLogs) {
        container.removeChild(container.firstChild);
      }
      container.scrollTop = container.scrollHeight;
    },
    _createLogElement(logEntry) {
      const div = document.createElement("div");
      div.className = `log-entry log-${logEntry.level}`;
      div.innerHTML = `
            <span class="log-time">${logEntry.timestamp}</span>
            <span class="log-icon">${this._getLogIcon(logEntry.level)}</span>
            <span class="log-message">${logEntry.message}</span>
        `;
      return div;
    },
    _getLogIcon(level) {
      const icons = {
        info: "‚ÑπÔ∏è",
        success: "‚úÖ",
        warn: "‚ö†Ô∏è",
        error: "‚ùå"
      };
      return icons[level] || "‚ÑπÔ∏è";
    },
    clearPageLog() {
      this._logs = [];
      const container = document.getElementById("page-log-container");
      if (container) {
        container.innerHTML = '<div class="log-placeholder">ÊöÇÊó†Êó•ÂøóËÆ∞ÂΩï</div>';
      }
      if (typeof updateLogCount === "function") {
        updateLogCount();
      }
    },
    info(...args) {
      this._log("info", ...args);
    },
    success(...args) {
      this._log("success", ...args);
    },
    warn(...args) {
      this._log("warn", ...args);
    },
    error(...args) {
      this._log("error", ...args);
    }
  };
  const AI_PRESETS = {
    xinliu: {
      name: "ÂøÉÊµÅ",
      baseURL: "https://apis.iflow.cn/v1",
      model: "qwen3-max",
      defaultKey: "",
      keyPlaceholder: "sk-xxx"
    },
    openai: {
      name: "OpenAI",
      baseURL: "https://api.openai.com/v1",
      model: "gpt-4o-mini",
      defaultKey: "",
      keyPlaceholder: "sk-xxx"
    },
    claude: {
      name: "Claude",
      baseURL: "https://api.anthropic.com/v1",
      model: "claude-3-5-sonnet-20241022",
      defaultKey: "",
      keyPlaceholder: "sk-ant-xxx"
    },
    gemini: {
      name: "Google Gemini",
      baseURL: "https://generativelanguage.googleapis.com/v1beta",
      model: "gemini-2.0-flash-exp",
      defaultKey: "",
      keyPlaceholder: "AIzaSyxxx"
    },
    deepseek: {
      name: "DeepSeek",
      baseURL: "https://api.deepseek.com/v1",
      model: "deepseek-chat",
      defaultKey: "",
      keyPlaceholder: "sk-xxx"
    },
    custom: {
      name: "Ëá™ÂÆö‰πâ",
      baseURL: "",
      model: "",
      defaultKey: "",
      keyPlaceholder: "your-api-key"
    }
  };
  const ConfigManager = {
    // ÈÖçÁΩÆÈîÆÂêçÊò†Â∞Ñ
    keys: {
      learning: {
        playbackRate: "learning_playbackRate",
        waitTimeAfterComplete: "learning_waitTime",
        documentPageInterval: "learning_docInterval",
        expandDelay: "learning_expandDelay",
        muteMedia: "learning_muteMedia"
      },
      exam: {
        delay: "exam_delay",
        autoSubmit: "exam_autoSubmit",
        currentAI: "exam_currentAI"
      },
      progress: {
        processedNodes: "learning_processedNodes",
        completedChapters: "learning_completedChapters"
      }
    },
    // ÈªòËÆ§ÂÄº
    defaults: {
      learning: {
        playbackRate: 1,
        waitTimeAfterComplete: 2,
        documentPageInterval: 1,
        expandDelay: 3,
        muteMedia: false
      },
      exam: {
        delay: 3e3,
        autoSubmit: false,
        currentAI: "xinliu"
      }
    },
    // Ëé∑ÂèñÈÖçÁΩÆÂÄº
    get(category, key) {
      var _a, _b;
      const storageKey = (_a = this.keys[category]) == null ? void 0 : _a[key];
      const defaultValue = (_b = this.defaults[category]) == null ? void 0 : _b[key];
      if (storageKey) {
        return GM_getValue(storageKey, defaultValue);
      }
      return defaultValue;
    },
    // ÊâπÈáè‰øùÂ≠òÈÖçÁΩÆ
    saveAll(config) {
      Object.keys(this.keys.learning).forEach((key) => {
        if (config.learning && config.learning[key] !== void 0) {
          GM_setValue(this.keys.learning[key], config.learning[key]);
        }
      });
      Object.keys(this.keys.exam).forEach((key) => {
        if (config.exam && config.exam[key] !== void 0) {
          GM_setValue(this.keys.exam[key], config.exam[key]);
        }
      });
      if (config.theme) {
        localStorage.setItem("icve_theme_mode", config.theme);
      }
    },
    // Ëé∑ÂèñAIÈÖçÁΩÆ
    getAIConfig(aiType) {
      const preset = AI_PRESETS[aiType];
      return {
        apiKey: GM_getValue(`ai_key_${aiType}`, preset.defaultKey),
        baseURL: GM_getValue(`ai_baseurl_${aiType}`, preset.baseURL),
        model: GM_getValue(`ai_model_${aiType}`, preset.model)
      };
    }
  };
  const state = {
    // Â≠¶‰π†Ê®°ÂºèÁä∂ÊÄÅ
    learning: {
      isRunning: false,
      currentNode: null,
      allNodes: [],
      completedCount: 0,
      totalCount: 0,
      examCount: 0,
      processedNodes: new Set(GM_getValue(ConfigManager.keys.progress.processedNodes, [])),
      completedChapters: new Set(GM_getValue(ConfigManager.keys.progress.completedChapters, [])),
      currentPage: 1,
      totalPages: 1,
      isDocument: false,
      mediaWatching: false
    },
    // Á≠îÈ¢òÊ®°ÂºèÁä∂ÊÄÅ
    exam: {
      isRunning: false,
      currentQuestionIndex: 0,
      totalQuestions: 0
    }
  };
  function saveLearningProgress() {
    GM_setValue(ConfigManager.keys.progress.processedNodes, Array.from(state.learning.processedNodes));
    GM_setValue(ConfigManager.keys.progress.completedChapters, Array.from(state.learning.completedChapters));
  }
  function loadLearningProgress() {
    const processedNodes = GM_getValue(ConfigManager.keys.progress.processedNodes, []);
    const completedChapters = GM_getValue(ConfigManager.keys.progress.completedChapters, []);
    state.learning.processedNodes = new Set(processedNodes);
    state.learning.completedChapters = new Set(completedChapters);
  }
  const CONFIG = {
    learning: {
      playbackRate: ConfigManager.get("learning", "playbackRate"),
      waitTimeAfterComplete: ConfigManager.get("learning", "waitTimeAfterComplete"),
      documentPageInterval: ConfigManager.get("learning", "documentPageInterval"),
      expandDelay: ConfigManager.get("learning", "expandDelay"),
      muteMedia: ConfigManager.get("learning", "muteMedia")
    },
    exam: {
      delay: ConfigManager.get("exam", "delay"),
      autoSubmit: ConfigManager.get("exam", "autoSubmit"),
      currentAI: ConfigManager.get("exam", "currentAI")
    },
    theme: localStorage.getItem("icve_theme_mode") || "light",
    currentTab: "learning"
  };
  function saveConfig() {
    ConfigManager.saveAll(CONFIG);
  }
  function createLearningTab() {
    return `
        <div class="tab-inner">
            <!-- Áä∂ÊÄÅÂå∫Âüü -->
            <div class="learning-status-section">
                <div class="status-row">
                    <span class="status-item">
                        <span class="status-dot" id="learning-status-dot"></span>
                        <span id="learning-status">ÂÅúÊ≠¢‰∏≠</span>
                    </span>
                    <span class="status-item">
                        <span>üìä</span>
                        <span id="learning-progress">0/0</span>
                    </span>
                    <span class="status-item">
                        <span>‚úÖ</span>
                        <span><span id="learning-processed">0</span>‰∏™</span>
                    </span>
                </div>
                <div class="progress-bar-wrapper">
                    <div class="progress-bar" id="learning-progress-bar" data-progress="0%"></div>
                </div>
                <div class="current-node">
                    <span class="node-icon">üìñ</span>
                    <span class="node-text" id="learning-current" title="">Á≠âÂæÖÂºÄÂßã...</span>
                </div>
                <div class="status-message" id="learning-progress-text" style="margin-top: 8px;">Á≠âÂæÖÂºÄÂßã...</div>
            </div>

            <!-- ÊéßÂà∂ÊåâÈíÆ -->
            <div class="learning-controls">
                <button class="btn btn-primary btn-large" id="learning-start">‚ñ∂Ô∏è ÂºÄÂßãÂ≠¶‰π†</button>
                <div class="btn-group">
                    <button class="btn btn-outline" id="learning-scan">üîç Êâ´Êèè</button>
                    <button class="btn btn-outline" id="learning-reset">üîÑ ÈáçÁΩÆ</button>
                    <label class="btn btn-outline btn-toggle-label">
                        <input type="checkbox" id="learning-mute-media" ${CONFIG.learning.muteMedia ? "checked" : ""} hidden>
                        <span class="toggle-icon">${CONFIG.learning.muteMedia ? "üîá" : "üîä"}</span>
                        <span>ÈùôÈü≥</span>
                    </label>
                </div>
            </div>

            <!-- Â≠¶‰π†ÈÖçÁΩÆ -->
            <div class="settings-section">
                <div class="section-header">
                    <h3>‚öôÔ∏è Â≠¶‰π†ÈÖçÁΩÆ</h3>
                </div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">Êí≠ÊîæÂÄçÈÄü</label>
                        <select id="learning-playback-rate" class="select-control">
                            <option value="1.0" ${CONFIG.learning.playbackRate === 1 ? "selected" : ""}>1.0x</option>
                            <option value="1.5" ${CONFIG.learning.playbackRate === 1.5 ? "selected" : ""}>1.5x</option>
                            <option value="2.0" ${CONFIG.learning.playbackRate === 2 ? "selected" : ""}>2.0x</option>
                            <option value="3.0" ${CONFIG.learning.playbackRate === 3 ? "selected" : ""}>3.0x</option>
                            <option value="4.0" ${CONFIG.learning.playbackRate === 4 ? "selected" : ""}>4.0x</option>
                            <option value="6.0" ${CONFIG.learning.playbackRate === 6 ? "selected" : ""}>6.0x</option>
                            <option value="8.0" ${CONFIG.learning.playbackRate === 8 ? "selected" : ""}>8.0x</option>
                            <option value="16.0" ${CONFIG.learning.playbackRate === 16 ? "selected" : ""}>16.0x</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">ÂÆåÊàêÁ≠âÂæÖ</label>
                        <div class="input-with-unit">
                            <input type="number" id="learning-wait-time" class="input-control"
                                   value="${CONFIG.learning.waitTimeAfterComplete}" min="1" max="30">
                            <span class="unit">Áßí</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">ÁøªÈ°µÈó¥Èöî</label>
                        <div class="input-with-unit">
                            <input type="number" id="learning-doc-interval" class="input-control"
                                   value="${CONFIG.learning.documentPageInterval}" min="1" max="60">
                            <span class="unit">Áßí</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Â±ïÂºÄÂª∂Ëøü</label>
                        <div class="input-with-unit">
                            <input type="number" id="learning-expand-delay" class="input-control"
                                   value="${CONFIG.learning.expandDelay}" min="1" max="10" step="0.5">
                            <span class="unit">Áßí</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
  }
  function getAIConfig$1() {
    const preset = AI_PRESETS[CONFIG.exam.currentAI];
    return {
      apiKey: GM_getValue(`ai_key_${CONFIG.exam.currentAI}`, preset.defaultKey),
      baseURL: GM_getValue(`ai_baseurl_${CONFIG.exam.currentAI}`, preset.baseURL),
      model: GM_getValue(`ai_model_${CONFIG.exam.currentAI}`, preset.model)
    };
  }
  function createExamTab() {
    let aiOptions = "";
    for (const [key, preset] of Object.entries(AI_PRESETS)) {
      const selected = CONFIG.exam.currentAI === key ? "selected" : "";
      aiOptions += `<option value="${key}" ${selected}>${preset.name}</option>`;
    }
    const aiConfig = getAIConfig$1();
    return `
        <div class="tab-inner">
            <!-- Áä∂ÊÄÅÊ¶ÇËßà -->
            <div class="exam-status-compact">
                <div class="status-line">
                    <div class="status-left">
                        <span class="status-dot" id="exam-status-dot"></span>
                        <span class="status-text" id="exam-status">Â∞±Áª™</span>
                    </div>
                    <div class="status-right">
                        <span class="progress-mini" id="exam-progress">0/0</span>
                    </div>
                </div>
                <div class="progress-bar-wrapper">
                    <div class="progress-bar" id="exam-progress-bar" data-progress="0%"></div>
                </div>
            </div>

            <!-- AI‰∏éÂØÜÈí•ÈÖçÁΩÆ -->
            <div class="exam-config-compact">
                <div class="config-row">
                    <label class="row-label">üîÆ AIÊ®°Âûã</label>
                    <select id="exam-ai-model" class="select-control select-mini">
                        ${aiOptions}
                    </select>
                </div>
                <div class="config-row config-key">
                    <label class="row-label">üîë ÂØÜÈí•</label>
                    <input type="text" id="exam-api-key" class="input-control input-mini"
                           value="${aiConfig.apiKey}"
                           placeholder="${AI_PRESETS[CONFIG.exam.currentAI].keyPlaceholder}">
                </div>
                <div class="config-row-dual">
                    <div class="config-col">
                        <label class="row-label-sm">‚è±Ô∏è Âª∂Ëøü</label>
                        <div class="input-unit-mini">
                            <input type="number" id="exam-delay" class="input-mini-num"
                                   value="${CONFIG.exam.delay / 1e3}" min="2" max="15">
                            <span class="unit-sm">Áßí</span>
                        </div>
                    </div>
                    <div class="config-col">
                        <label class="row-label-sm">üìù ‰∫§Âç∑</label>
                        <label class="switch-mini">
                            <input type="checkbox" id="exam-auto-submit" ${CONFIG.exam.autoSubmit ? "checked" : ""}>
                            <span class="slider-mini"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- ÊéßÂà∂ÊåâÈíÆ -->
            <div class="exam-buttons-compact">
                <button class="btn btn-primary btn-start" id="exam-start">‚ñ∂Ô∏è ÂºÄÂßã</button>
                <button class="btn btn-primary btn-stop" id="exam-stop" disabled>‚èπ ÂÅúÊ≠¢</button>
            </div>

            <!-- È´òÁ∫ßÈÖçÁΩÆ -->
            <details class="advanced-mini">
                <summary>‚öôÔ∏è È´òÁ∫ß</summary>
                <div class="advanced-body">
                    <div class="advanced-row">
                        <label>üåê APIÂú∞ÂùÄ</label>
                        <input type="text" id="exam-api-url" class="input-control input-mini"
                               value="${aiConfig.baseURL}"
                               placeholder="https://api.example.com/v1">
                    </div>
                    <div class="advanced-row">
                        <label>üéØ Ê®°Âûã</label>
                        <input type="text" id="exam-api-model-name" class="input-control input-mini"
                               value="${aiConfig.model}"
                               placeholder="model-name">
                    </div>
                </div>
            </details>

            <!-- Áä∂ÊÄÅÊèêÁ§∫ -->
            <div class="status-msg-mini" id="exam-message">üí° ÈÖçÁΩÆÂÆåÊàêÂêéÁÇπÂáª"ÂºÄÂßã"</div>
        </div>
    `;
  }
  function createLogTab() {
    return `
        <div class="log-tab-container">
            <div class="log-container" id="page-log-container">
                <div class="log-placeholder">ÊöÇÊó†Êó•ÂøóËÆ∞ÂΩï</div>
            </div>
            <div class="log-footer">
                <span class="log-count-text" id="log-count">0 Êù°ËÆ∞ÂΩï</span>
                <button class="btn btn-secondary btn-clear-log" id="clear-page-log">üóë Ê∏ÖÁ©∫Êó•Âøó</button>
            </div>
        </div>
    `;
  }
  function addStyles() {
    const style = document.createElement("style");
    style.textContent = `
            /* ==================== ÂØºÂÖ•Â≠ó‰Ωì ==================== */
            @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

            /* ==================== CSS ÂèòÈáèÁ≥ªÁªü ==================== */
            :root {
                /* ‰∏ªËâ≤Ë∞É - ÊûÅÂÖâÊ∏êÂèòÁ≥ª */
                --icve-primary-from: #6366f1;
                --icve-primary-via: #8b5cf6;
                --icve-primary-to: #d946ef;
                --icve-primary-glow: rgba(139, 92, 246, 0.4);

                /* ÂäüËÉΩËâ≤ */
                --icve-success-from: #10b981;
                --icve-success-to: #34d399;
                --icve-success-glow: rgba(16, 185, 129, 0.35);
                --icve-warning-from: #f59e0b;
                --icve-warning-to: #fbbf24;
                --icve-warning-glow: rgba(245, 158, 11, 0.35);
                --icve-info-from: #0ea5e9;
                --icve-info-to: #38bdf8;
                --icve-info-glow: rgba(14, 165, 233, 0.35);
                --icve-danger-from: #ef4444;
                --icve-danger-to: #f87171;
                --icve-danger-glow: rgba(239, 68, 68, 0.35);

                /* ÊµÖËâ≤‰∏ªÈ¢ò */
                --icve-bg-base: #f8fafc;
                --icve-bg-elevated: #ffffff;
                --icve-bg-sunken: #f1f5f9;
                --icve-bg-glass: rgba(255, 255, 255, 0.72);
                --icve-bg-glass-strong: rgba(255, 255, 255, 0.88);
                --icve-border-subtle: rgba(148, 163, 184, 0.2);
                --icve-border-default: rgba(148, 163, 184, 0.35);
                --icve-text-primary: #0f172a;
                --icve-text-secondary: #475569;
                --icve-text-tertiary: #94a3b8;
                --icve-text-inverted: #ffffff;
                --icve-shadow-ambient: 0 8px 32px rgba(15, 23, 42, 0.08);
                --icve-shadow-elevated: 0 24px 48px rgba(15, 23, 42, 0.12);
                --icve-shadow-glow: 0 0 60px rgba(139, 92, 246, 0.15);

                /* Âä®Áîª */
                --icve-ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
                --icve-ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
                --icve-duration-fast: 0.2s;
                --icve-duration-normal: 0.35s;
                --icve-duration-slow: 0.5s;
            }

            /* ==================== Âü∫Á°ÄÈù¢ÊùøÊ†∑Âºè ==================== */
            #icve-tabbed-panel {
                position: fixed;
                top: 24px;
                right: 24px;
                width: 400px;
                max-height: 92vh;
                z-index: 999999;
                font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
                animation: icvePanelEnter 0.7s var(--icve-ease-out-expo);
            }

            @keyframes icvePanelEnter {
                0% {
                    opacity: 0;
                    transform: translateX(80px) scale(0.92) rotateY(-8deg);
                    filter: blur(8px);
                }
                100% {
                    opacity: 1;
                    transform: translateX(0) scale(1) rotateY(0);
                    filter: blur(0);
                }
            }

            .panel-container {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(24px) saturate(180%);
                -webkit-backdrop-filter: blur(24px) saturate(180%);
                border-radius: 24px;
                border: 1px solid var(--icve-border-subtle);
                box-shadow:
                    var(--icve-shadow-elevated),
                    var(--icve-shadow-glow),
                    inset 0 1px 1px rgba(255, 255, 255, 0.6);
                overflow: hidden;
                display: flex;
                flex-direction: column;
                max-height: 92vh;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                position: relative;
            }

            /* Èù¢ÊùøÂÖâÊôïËÉåÊôØ */
            .panel-container::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(
                    ellipse at 30% 20%,
                    rgba(99, 102, 241, 0.08) 0%,
                    transparent 50%
                ),
                radial-gradient(
                    ellipse at 70% 80%,
                    rgba(217, 70, 239, 0.06) 0%,
                    transparent 50%
                );
                pointer-events: none;
                z-index: 0;
            }

            .panel-container:hover {
                box-shadow:
                    0 32px 64px rgba(15, 23, 42, 0.16),
                    0 0 80px rgba(139, 92, 246, 0.2),
                    inset 0 1px 1px rgba(255, 255, 255, 0.6);
            }

            /* ==================== Â§¥ÈÉ®Ê†∑Âºè ==================== */
            .panel-header {
                padding: 18px 20px;
                background: linear-gradient(
                    135deg,
                    var(--icve-primary-from) 0%,
                    var(--icve-primary-via) 50%,
                    var(--icve-primary-to) 100%
                );
                cursor: move;
                display: flex;
                justify-content: space-between;
                align-items: center;
                user-select: none;
                position: relative;
                z-index: 1;
                overflow: hidden;
            }

            /* Â§¥ÈÉ®Âä®ÊÄÅÂÖâÊïà */
            .panel-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.2) 50%,
                    transparent 100%
                );
                animation: headerShine 4s ease-in-out infinite;
            }

            @keyframes headerShine {
                0%, 100% { left: -100%; }
                50% { left: 100%; }
            }

            /* Â§¥ÈÉ®Â∫ïÈÉ®Ê∏êÂèòÈò¥ÂΩ± */
            .panel-header::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.4) 50%,
                    transparent 100%
                );
            }

            .panel-title {
                font-weight: 700;
                font-size: 16px;
                color: var(--icve-text-inverted);
                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                letter-spacing: 0.5px;
                position: relative;
                z-index: 1;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .panel-title::before {
                content: '';
                width: 8px;
                height: 8px;
                background: var(--icve-text-inverted);
                border-radius: 50%;
                box-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
                animation: titlePulse 2s ease-in-out infinite;
            }

            @keyframes titlePulse {
                0%, 100% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.6; transform: scale(0.8); }
            }

            .header-controls {
                display: flex;
                gap: 10px;
                position: relative;
                z-index: 1;
            }

            /* Â§¥ÈÉ®ÊéßÂà∂ÊåâÈíÆÂä®Áîª‰ºòÂåñ */
            .theme-toggle, .panel-toggle {
                background: rgba(255, 255, 255, 0.18);
                border: 1px solid rgba(255, 255, 255, 0.25);
                color: white;
                width: 36px;
                height: 36px;
                border-radius: 12px;
                cursor: pointer;
                font-size: 16px;
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
                display: flex;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(8px);
                position: relative;
                overflow: hidden;
            }

            .theme-toggle::before, .panel-toggle::before {
                content: '';
                position: absolute;
                inset: 0;
                background: rgba(255, 255, 255, 0);
                transition: background var(--icve-duration-fast) ease;
            }

            .theme-toggle:hover, .panel-toggle:hover {
                background: rgba(255, 255, 255, 0.28);
                border-color: rgba(255, 255, 255, 0.4);
                transform: scale(1.08) rotate(6deg);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            }

            .theme-toggle:hover::before, .panel-toggle:hover::before {
                background: rgba(255, 255, 255, 0.1);
            }

            .theme-toggle:active, .panel-toggle:active {
                transform: scale(0.96) rotate(0deg);
                transition: transform 0.1s ease;
            }

            /* ==================== Ê†áÁ≠æÈ°µÂØºËà™ ==================== */
            .tab-nav {
                display: flex;
                background: var(--icve-bg-sunken);
                padding: 8px 12px 0;
                gap: 4px;
                position: relative;
                z-index: 1;
            }

            .tab-btn {
                flex: 1;
                padding: 14px 16px;
                background: transparent;
                border: none;
                cursor: pointer;
                font-family: 'Outfit', sans-serif;
                font-size: 14px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                position: relative;
                border-radius: 14px 14px 0 0;
                letter-spacing: 0.3px;
            }

            .tab-btn:hover {
                color: var(--icve-primary-via);
                background: rgba(139, 92, 246, 0.08);
            }

            .tab-btn.active {
                color: var(--icve-primary-via);
                background: var(--icve-bg-glass-strong);
                box-shadow: 0 -4px 16px rgba(139, 92, 246, 0.1);
            }

            .tab-btn.active::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 16px;
                right: 16px;
                height: 3px;
                background: linear-gradient(
                    90deg,
                    var(--icve-primary-from),
                    var(--icve-primary-via),
                    var(--icve-primary-to)
                );
                border-radius: 3px 3px 0 0;
                animation: tabIndicator 0.4s var(--icve-ease-spring);
            }

            @keyframes tabIndicator {
                from {
                    transform: scaleX(0);
                    opacity: 0;
                }
                to {
                    transform: scaleX(1);
                    opacity: 1;
                }
            }

            /* ==================== Ê†áÁ≠æÈ°µÂÜÖÂÆπ ==================== */
            .tab-content-wrapper {
                overflow-y: auto;
                max-height: calc(92vh - 140px);
                scrollbar-width: thin;
                scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
                scrollbar-gutter: stable;
                position: relative;
                z-index: 1;
            }

            .tab-content-wrapper::-webkit-scrollbar {
                width: 6px;
            }

            .tab-content-wrapper::-webkit-scrollbar-track {
                background: transparent;
            }

            .tab-content-wrapper::-webkit-scrollbar-thumb {
                background: linear-gradient(
                    180deg,
                    var(--icve-primary-from),
                    var(--icve-primary-to)
                );
                border-radius: 10px;
            }

            .tab-content-wrapper::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(
                    180deg,
                    var(--icve-primary-via),
                    var(--icve-primary-to)
                );
            }

            .tab-content-wrapper.collapsed {
                display: none;
            }

            .tab-nav.collapsed {
                display: none;
            }

            .tab-pane {
                display: none;
                background: var(--icve-bg-glass-strong);
                animation: tabPaneFade 0.5s var(--icve-ease-out-expo);
            }

            @keyframes tabPaneFade {
                from {
                    opacity: 0;
                    transform: translateY(16px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .tab-pane.active {
                display: block;
            }

            .tab-inner {
                padding: 20px;
            }

            /* ==================== Áä∂ÊÄÅÂç°Áâá - ÁéªÁíÉÊãüÊÄÅ ==================== */
            /* ==================== Â≠¶‰π†È°µÈù¢Ê†∑Âºè ==================== */
            .learning-status-section {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 16px;
                padding: 14px 16px;
                margin-bottom: 14px;
                border: 1px solid var(--icve-border-subtle);
            }

            .status-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
            }

            .status-item {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-primary);
            }

            .status-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #94a3b8;
                transition: all 0.3s ease;
            }

            .status-dot.running {
                background: #10b981;
                box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
                animation: pulse 1.5s infinite;
            }

            .status-dot.completed {
                background: #8b5cf6;
            }

            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }

            .learning-controls {
                display: flex;
                flex-direction: column;
                gap: 10px;
                margin-bottom: 14px;
            }

            .btn-large {
                width: 100%;
                padding: 14px 20px;
                font-size: 15px;
                background: linear-gradient(
                    135deg,
                    var(--icve-success-from) 0%,
                    var(--icve-success-to) 100%
                );
                color: white !important;
                box-shadow: 0 4px 16px var(--icve-success-glow);
            }

            .btn-large:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 6px 24px var(--icve-success-glow);
            }

            .btn-large:disabled {
                background: linear-gradient(135deg, #9ca3af, #6b7280);
                box-shadow: none;
                cursor: not-allowed;
                opacity: 0.7;
            }

            .btn-group {
                display: flex;
                gap: 8px;
            }

            .btn-group .btn {
                flex: 1;
                padding: 10px 12px;
                font-size: 13px;
            }

            .btn-outline {
                background: var(--icve-bg-elevated) !important;
                color: #374151 !important;
                border: 1px solid var(--icve-border-subtle) !important;
            }

            .btn-outline:hover {
                background: var(--icve-bg-glass) !important;
                border-color: var(--icve-primary-from) !important;
            }

            .btn-toggle-label {
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 4px;
                color: #374151 !important;
            }

            .btn-toggle-label:has(input:checked) {
                background: linear-gradient(135deg, var(--icve-primary-from), var(--icve-primary-to)) !important;
                color: white !important;
                border-color: transparent !important;
            }

            .settings-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .status-card-compact {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 18px;
                padding: 16px;
                margin-bottom: 16px;
                border: 1px solid var(--icve-border-subtle);
                box-shadow:
                    var(--icve-shadow-ambient),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                position: relative;
                overflow: hidden;
            }

            .status-card-compact::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.8),
                    transparent
                );
            }

            /* Áä∂ÊÄÅÂç°ÁâáhoverÊïàÊûú‰ºòÂåñ */
            .status-card-compact:hover {
                transform: translateY(-2px);
                box-shadow:
                    0 12px 32px rgba(15, 23, 42, 0.1),
                    0 0 32px rgba(139, 92, 246, 0.08),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
            }

            .status-inline {
                display: flex;
                gap: 10px;
                margin-bottom: 14px;
            }

            .status-badge {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                padding: 10px 12px;
                background: var(--icve-bg-elevated);
                border-radius: 12px;
                border: 1px solid var(--icve-border-subtle);
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
                cursor: default;
            }

            .status-badge:hover {
                transform: translateY(-1px) scale(1.01);
                box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
                border-color: var(--icve-primary-via);
            }

            .badge-icon {
                font-size: 16px;
                line-height: 1;
            }

            .badge-value {
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
                font-family: 'JetBrains Mono', monospace;
            }

            /* ==================== ËøõÂ∫¶Êù° - Ê∏êÂèòÂèëÂÖâ ==================== */
            .progress-bar-wrapper {
                height: 8px;
                background: var(--icve-bg-sunken);
                border-radius: 10px;
                overflow: visible;
                box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.08);
                margin-bottom: 14px;
                position: relative;
            }

            .progress-bar {
                height: 100%;
                background: linear-gradient(
                    90deg,
                    var(--icve-primary-from),
                    var(--icve-primary-via),
                    var(--icve-primary-to)
                );
                width: 0%;
                transition: width 0.8s var(--icve-ease-out-expo);
                border-radius: 10px;
                position: relative;
                box-shadow:
                    0 0 20px var(--icve-primary-glow),
                    0 0 40px rgba(139, 92, 246, 0.2);
            }

            .progress-bar::before {
                content: attr(data-progress);
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                font-size: 11px;
                font-weight: 700;
                font-family: 'JetBrains Mono', monospace;
                color: var(--icve-primary-via);
                background: var(--icve-bg-elevated);
                padding: 4px 8px;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                border: 1px solid var(--icve-border-subtle);
            }

            .progress-bar::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(
                    90deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.4) 50%,
                    transparent 100%
                );
                animation: progressShimmer 2s ease-in-out infinite;
            }

            @keyframes progressShimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }

            .current-node {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 10px 14px;
                background: var(--icve-bg-elevated);
                border-radius: 10px;
                font-size: 12px;
                border: 1px solid var(--icve-border-subtle);
            }

            .node-icon {
                font-size: 16px;
                line-height: 1;
            }

            .node-text {
                flex: 1;
                color: var(--icve-text-secondary);
                font-weight: 600;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            /* ==================== ÊåâÈíÆÁ≥ªÁªü ==================== */
            .control-buttons-group {
                margin-bottom: 16px;
            }

            .primary-actions {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 12px;
            }

            .btn {
                padding: 12px 16px;
                border: none;
                border-radius: 14px;
                cursor: pointer;
                font-family: 'Outfit', sans-serif;
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-inverted);
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
                position: relative;
                overflow: hidden;
                letter-spacing: 0.3px;
            }

            .btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 50%;
                background: linear-gradient(
                    180deg,
                    rgba(255, 255, 255, 0.2) 0%,
                    transparent 100%
                );
                pointer-events: none;
            }

            .btn::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 0;
                height: 0;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                transform: translate(-50%, -50%);
                transition: width 0.6s ease, height 0.6s ease;
            }

            .btn:active::after {
                width: 400px;
                height: 400px;
            }

            .btn:disabled {
                opacity: 0.4;
                cursor: not-allowed;
                transform: none !important;
                filter: grayscale(0.3);
            }

            .btn-primary {
                height: 50px;
                font-size: 15px;
            }

            .btn-start {
                background: linear-gradient(
                    135deg,
                    var(--icve-success-from) 0%,
                    var(--icve-success-to) 100%
                );
                box-shadow:
                    0 4px 16px var(--icve-success-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

            /* ÊåâÈíÆhoerÊïàÊûú‰ºòÂåñ */
            .btn-start:hover:not(:disabled) {
                transform: translateY(-2px) scale(1.01);
                box-shadow:
                    0 6px 24px var(--icve-success-glow),
                    0 0 32px rgba(16, 185, 129, 0.18),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

            .btn-start:active:not(:disabled) {
                transform: translateY(0) scale(0.98);
                transition: transform 0.1s ease;
            }

            .btn-stop {
                background: linear-gradient(
                    135deg,
                    var(--icve-warning-from) 0%,
                    var(--icve-warning-to) 100%
                );
                box-shadow:
                    0 4px 16px var(--icve-warning-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

            .btn-stop:hover:not(:disabled) {
                transform: translateY(-2px) scale(1.01);
                box-shadow:
                    0 6px 24px var(--icve-warning-glow),
                    0 0 32px rgba(245, 158, 11, 0.18),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

            .btn-stop:active:not(:disabled) {
                transform: translateY(0) scale(0.98);
                transition: transform 0.1s ease;
            }

            .secondary-actions {
                display: flex;
                gap: 8px;
            }

            .btn-secondary {
                flex: 1;
                height: 40px;
                font-size: 13px;
                font-weight: 600;
                background: linear-gradient(
                    135deg,
                    #64748b 0%,
                    #475569 100%
                );
                box-shadow:
                    0 3px 12px rgba(71, 85, 105, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            .btn-secondary:hover:not(:disabled) {
                transform: translateY(-1px);
                box-shadow:
                    0 4px 16px rgba(71, 85, 105, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            .btn-secondary:active:not(:disabled) {
                transform: translateY(0);
                transition: transform 0.1s ease;
            }

            .btn-scan {
                background: linear-gradient(
                    135deg,
                    var(--icve-info-from) 0%,
                    var(--icve-info-to) 100%
                );
                box-shadow:
                    0 3px 12px var(--icve-info-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            .btn-scan:hover:not(:disabled) {
                transform: translateY(-1px);
                box-shadow:
                    0 5px 18px var(--icve-info-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            .btn-reset {
                background: linear-gradient(
                    135deg,
                    var(--icve-primary-via) 0%,
                    var(--icve-primary-to) 100%
                );
                box-shadow:
                    0 3px 12px var(--icve-primary-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            .btn-reset:hover:not(:disabled) {
                transform: translateY(-1px);
                box-shadow:
                    0 5px 18px var(--icve-primary-glow),
                    inset 0 1px 0 rgba(255, 255, 255, 0.15);
            }

            /* ÈùôÈü≥ÂàáÊç¢ÊåâÈíÆ‰ºòÂåñ */
            .btn-toggle {
                flex: 1;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
                background: var(--icve-bg-elevated);
                border-radius: 12px;
                cursor: pointer;
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                border: 2px solid var(--icve-border-default);
                padding: 0 12px;
            }

            .btn-toggle:hover {
                border-color: var(--icve-primary-via);
                color: var(--icve-primary-via);
                box-shadow: 0 3px 12px rgba(139, 92, 246, 0.12);
                transform: translateY(-1px);
            }

            .btn-toggle:active {
                transform: translateY(0);
                transition: transform 0.1s ease;
            }

            .btn-toggle input[type="checkbox"] {
                display: none;
            }

            .toggle-icon {
                font-size: 16px;
                transition: transform var(--icve-duration-normal) var(--icve-ease-spring);
            }

            .btn-toggle:hover .toggle-icon {
                transform: scale(1.2);
            }

            .toggle-text {
                font-size: 13px;
            }

            /* ==================== ËÆæÁΩÆÂå∫Âüü ==================== */
            .settings-section {
                margin-bottom: 16px;
                padding: 16px;
                border-radius: 16px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border: 1px solid var(--icve-border-subtle);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4);
            }

            .settings-section:hover {
                box-shadow:
                    0 8px 24px rgba(0, 0, 0, 0.06),
                    inset 0 1px 0 rgba(255, 255, 255, 0.4);
                border-color: var(--icve-border-default);
            }

            .settings-section:last-child {
                margin-bottom: 0;
            }

            .section-header h3 {
                margin: 0 0 12px 0;
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
                letter-spacing: 0.3px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .settings-grid-compact {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 14px;
            }

            .setting-item {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .setting-label {
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                letter-spacing: 0.3px;
                text-transform: uppercase;
            }

            .input-with-unit {
                display: flex;
                align-items: center;
                background: var(--icve-bg-elevated);
                border-radius: 10px;
                padding: 4px 4px 4px 12px;
                border: 2px solid var(--icve-border-default);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .input-with-unit:focus-within {
                border-color: var(--icve-primary-via);
                box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            }

            .input-with-unit input {
                flex: 1;
                border: none;
                background: transparent;
                padding: 8px 4px;
                font-family: 'JetBrains Mono', monospace;
                font-size: 14px;
                font-weight: 600;
                color: var(--icve-text-primary);
                outline: none;
            }

            .input-with-unit .unit {
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                padding: 0 10px;
                white-space: nowrap;
            }

            .select-control, .input-control {
                width: 100%;
                padding: 10px 12px;
                border: 2px solid var(--icve-border-default);
                border-radius: 10px;
                background: var(--icve-bg-elevated);
                color: var(--icve-text-primary);
                font-family: 'Outfit', sans-serif;
                font-size: 14px;
                font-weight: 500;
                outline: none;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                cursor: pointer;
            }

            .select-control:hover, .input-control:hover {
                border-color: var(--icve-border-default);
                background: var(--icve-bg-sunken);
            }

            .select-control:focus, .input-control:focus {
                border-color: var(--icve-primary-via);
                background: var(--icve-bg-elevated);
                box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            }

            /* ==================== Á≠îÈ¢òÈ°µÈÖçÁΩÆ ==================== */
            .quick-config {
                display: flex;
                gap: 10px;
                margin-bottom: 16px;
                padding: 14px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 14px;
                border: 1px solid var(--icve-border-subtle);
            }

            .config-item {
                flex: 1;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .config-item.config-ai {
                flex: 1.6;
                min-width: 0;
            }

            .config-item.config-delay {
                flex: 1.4;
                min-width: 0;
            }

            .config-item.config-submit {
                flex: 1;
                min-width: 0;
            }

            .config-label {
                font-size: 18px;
                line-height: 1;
            }

            .select-compact, .input-compact {
                flex: 1;
                min-width: 0;
                height: 36px;
                padding: 6px 10px;
                font-size: 13px;
                border-radius: 8px;
            }

            .config-ai .select-compact {
                font-weight: 700;
                color: var(--icve-primary-via);
            }

            .config-delay .input-compact {
                text-align: center;
                font-weight: 600;
                font-family: 'JetBrains Mono', monospace;
            }

            .input-with-unit-inline {
                flex: 1;
                display: flex;
                align-items: center;
                gap: 4px;
                background: var(--icve-bg-elevated);
                border-radius: 8px;
                padding: 4px 8px;
                border: 2px solid var(--icve-border-default);
            }

            .input-with-unit-inline input {
                flex: 1;
                border: none;
                background: transparent;
                padding: 4px;
                font-family: 'JetBrains Mono', monospace;
                font-size: 13px;
                font-weight: 600;
                outline: none;
                color: var(--icve-text-primary);
            }

            .input-with-unit-inline .unit {
                font-size: 11px;
                color: var(--icve-text-tertiary);
                font-weight: 600;
            }

            .switch-item-inline {
                display: flex;
                align-items: center;
                gap: 6px;
                cursor: pointer;
            }

            .switch-item-inline input[type="checkbox"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
                accent-color: var(--icve-primary-via);
            }

            .switch-label-inline {
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                cursor: pointer;
                white-space: nowrap;
            }

            /* ==================== Á≠îÈ¢òÈ°µÈù¢‰∏ìÂ±ûÊ†∑Âºè ==================== */
            /* Á¥ßÂáëÂûãÁä∂ÊÄÅÂå∫ */
            .exam-status-compact {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 12px;
                padding: 10px 12px;
                margin-bottom: 10px;
                border: 1px solid var(--icve-border-subtle);
            }

            .status-line {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }

            .status-left {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .status-text {
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-primary);
            }

            .progress-mini {
                font-size: 12px;
                font-weight: 700;
                color: var(--icve-text-secondary);
                font-family: 'JetBrains Mono', monospace;
            }

            /* Á¥ßÂáëÂûãÈÖçÁΩÆÂå∫ */
            .exam-config-compact {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 12px;
                padding: 10px;
                margin-bottom: 10px;
                border: 1px solid var(--icve-border-subtle);
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .config-row {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .config-row.config-key {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(52, 211, 153, 0.05));
                padding: 6px 8px;
                border-radius: 8px;
                border: 1px solid rgba(16, 185, 129, 0.15);
            }

            .row-label {
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                white-space: nowrap;
                min-width: 80px;
                display: inline-flex;
                align-items: center;
            }

            .select-mini, .input-mini {
                flex: 1;
                height: 32px;
                padding: 4px 8px;
                font-size: 13px;
                border-radius: 8px;
            }

            .select-mini {
                font-weight: 600;
                color: var(--icve-primary-via);
            }

            .input-mini {
                font-family: 'JetBrains Mono', monospace;
            }

            .config-row-dual {
                display: flex;
                gap: 8px;
            }

            .config-col {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .row-label-sm {
                font-size: 11px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                text-transform: uppercase;
                letter-spacing: 0.3px;
            }

            .input-unit-mini {
                display: flex;
                align-items: center;
                gap: 4px;
                background: var(--icve-bg-elevated);
                border-radius: 6px;
                padding: 4px 6px;
                border: 2px solid var(--icve-border-default);
                height: 32px;
            }

            .input-mini-num {
                flex: 1;
                border: none;
                background: transparent;
                padding: 0;
                font-family: 'JetBrains Mono', monospace;
                font-size: 13px;
                font-weight: 600;
                outline: none;
                color: var(--icve-text-primary);
                text-align: center;
            }

            .unit-sm {
                font-size: 11px;
                color: var(--icve-text-tertiary);
                font-weight: 600;
            }

            .switch-mini {
                position: relative;
                display: inline-block;
                width: 42px;
                height: 24px;
            }

            .switch-mini input[type="checkbox"] {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .slider-mini {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: #cbd5e1;
                border-radius: 24px;
                transition: all 0.3s;
            }

            .slider-mini::before {
                content: '';
                position: absolute;
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background: white;
                border-radius: 50%;
                transition: all 0.3s;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .switch-mini input:checked + .slider-mini {
                background: linear-gradient(135deg, var(--icve-primary-from), var(--icve-primary-to));
            }

            .switch-mini input:checked + .slider-mini::before {
                transform: translateX(18px);
            }

            /* Á¥ßÂáëÂûãÊåâÈíÆ */
            .exam-buttons-compact {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-bottom: 10px;
            }

            .exam-buttons-compact .btn {
                height: 42px;
                font-size: 14px;
            }

            /* Á¥ßÂáëÂûãÈ´òÁ∫ßÈÖçÁΩÆ */
            .advanced-mini {
                margin-bottom: 10px;
                border: 1px solid var(--icve-border-default);
                border-radius: 10px;
                overflow: hidden;
            }

            .advanced-mini summary {
                padding: 8px 12px;
                background: var(--icve-bg-sunken);
                cursor: pointer;
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                user-select: none;
                list-style: none;
            }

            .advanced-mini summary::-webkit-details-marker {
                display: none;
            }

            .advanced-mini[open] {
                border-color: var(--icve-primary-via);
            }

            .advanced-mini summary:hover {
                background: var(--icve-bg-elevated);
                color: var(--icve-primary-via);
            }

            .advanced-body {
                padding: 10px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                background: var(--icve-bg-glass);
            }

            .advanced-row {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }

            .advanced-row label {
                font-size: 11px;
                font-weight: 600;
                color: var(--icve-text-secondary);
            }

            /* Á¥ßÂáëÂûãÁä∂ÊÄÅÊ∂àÊÅØ */
            .status-msg-mini {
                padding: 8px 10px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 8px;
                font-size: 12px;
                color: var(--icve-text-secondary);
                text-align: center;
                border: 1px solid var(--icve-border-subtle);
                font-weight: 500;
            }
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 16px;
                padding: 16px;
                margin-bottom: 16px;
                border: 1px solid var(--icve-border-subtle);
                box-shadow: var(--icve-shadow-ambient);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .exam-status-overview:hover {
                box-shadow: 0 12px 32px rgba(15, 23, 42, 0.1);
                border-color: var(--icve-border-default);
            }

            .status-header-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 14px;
            }

            .status-indicator {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .status-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: #94a3b8;
                transition: all 0.3s ease;
                box-shadow: 0 0 0 3px rgba(148, 163, 184, 0.2);
            }

            .status-dot.ready {
                background: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            }

            .status-dot.running {
                background: #10b981;
                box-shadow: 0 0 12px rgba(16, 185, 129, 0.6);
                animation: pulse 1.5s infinite;
            }

            .status-dot.completed {
                background: #8b5cf6;
                box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            }

            .status-dot.error {
                background: #ef4444;
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
            }

            .status-text {
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
            }

            .ai-model-display {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 6px 12px;
                background: linear-gradient(
                    135deg,
                    rgba(139, 92, 246, 0.1),
                    rgba(217, 70, 239, 0.1)
                );
                border-radius: 10px;
                border: 1px solid rgba(139, 92, 246, 0.2);
            }

            .model-icon {
                font-size: 16px;
                line-height: 1;
            }

            .model-name {
                font-size: 13px;
                font-weight: 700;
                color: var(--icve-primary-via);
            }

            .progress-section {
                background: var(--icve-bg-elevated);
                border-radius: 12px;
                padding: 12px;
                border: 1px solid var(--icve-border-subtle);
            }

            .progress-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }

            .progress-label {
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .progress-count {
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
                font-family: 'JetBrains Mono', monospace;
            }

            .exam-ai-selector {
                margin-bottom: 16px;
                padding: 14px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 14px;
                border: 1px solid var(--icve-border-subtle);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .exam-ai-selector:hover {
                border-color: var(--icve-border-default);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            }

            .selector-label {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                margin-bottom: 10px;
            }

            .label-icon {
                font-size: 16px;
                line-height: 1;
            }

            .exam-api-config {
                margin-bottom: 16px;
                padding: 14px;
                background: linear-gradient(
                    135deg,
                    rgba(16, 185, 129, 0.05),
                    rgba(52, 211, 153, 0.05)
                );
                backdrop-filter: blur(8px);
                border-radius: 14px;
                border: 1px solid rgba(16, 185, 129, 0.15);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .exam-api-config:hover {
                border-color: rgba(16, 185, 129, 0.25);
                box-shadow: 0 4px 16px rgba(16, 185, 129, 0.08);
            }

            .config-header {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 10px;
            }

            .header-icon {
                font-size: 18px;
                line-height: 1;
            }

            .header-label {
                flex: 1;
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
            }

            .required-badge {
                padding: 3px 8px;
                background: linear-gradient(135deg, #ef4444, #f87171);
                color: white;
                font-size: 11px;
                font-weight: 700;
                border-radius: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .exam-settings-compact {
                margin-bottom: 16px;
                padding: 14px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 14px;
                border: 1px solid var(--icve-border-subtle);
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .setting-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 12px;
                background: var(--icve-bg-elevated);
                border-radius: 10px;
                border: 1px solid var(--icve-border-subtle);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .setting-row:hover {
                border-color: var(--icve-primary-via);
                box-shadow: 0 4px 12px rgba(139, 92, 246, 0.08);
            }

            .setting-label-compact {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-primary);
            }

            .switch-toggle {
                position: relative;
                display: inline-block;
                width: 48px;
                height: 26px;
            }

            .switch-toggle input[type="checkbox"] {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .switch-slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: #cbd5e1;
                border-radius: 26px;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .switch-slider::before {
                content: '';
                position: absolute;
                height: 20px;
                width: 20px;
                left: 3px;
                bottom: 3px;
                background: white;
                border-radius: 50%;
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .switch-toggle input:checked + .switch-slider {
                background: linear-gradient(135deg, var(--icve-primary-from), var(--icve-primary-to));
            }

            .switch-toggle input:checked + .switch-slider::before {
                transform: translateX(22px);
            }

            .switch-toggle:hover .switch-slider {
                box-shadow: 0 0 8px rgba(139, 92, 246, 0.3);
            }

            .exam-action-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 16px;
            }

            .exam-action-buttons .btn {
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            .btn-icon {
                font-size: 16px;
                line-height: 1;
            }

            .btn-text {
                font-size: 15px;
                font-weight: 700;
            }

            .summary-icon {
                font-size: 16px;
                line-height: 1;
            }

            .summary-badge {
                margin-left: auto;
                padding: 3px 8px;
                background: rgba(139, 92, 246, 0.1);
                color: var(--icve-primary-via);
                font-size: 11px;
                font-weight: 700;
                border-radius: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .message-icon {
                font-size: 16px;
                line-height: 1;
                margin-right: 6px;
            }

            /* ==================== API ÂØÜÈí•Âå∫Âüü ==================== */
            .api-key-section {
                margin-bottom: 16px;
                padding: 16px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 14px;
                border: 1px solid var(--icve-border-subtle);
            }

            .api-key-header {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 12px;
            }

            .api-icon {
                font-size: 18px;
                line-height: 1;
            }

            .api-label {
                font-size: 14px;
                font-weight: 700;
                color: var(--icve-text-primary);
            }

            .api-hint {
                margin-left: auto;
                font-size: 11px;
                color: var(--icve-text-tertiary);
            }

            .input-api-key {
                width: 100%;
                padding: 12px 14px;
                font-size: 14px;
                font-family: 'JetBrains Mono', monospace;
                font-weight: 500;
                background: var(--icve-bg-elevated);
                border: 2px solid var(--icve-border-default);
                border-radius: 10px;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                color: var(--icve-text-primary);
            }

            .input-api-key:focus {
                border-color: var(--icve-primary-via);
                box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.12);
                outline: none;
            }

            .input-api-key::placeholder {
                color: var(--icve-text-tertiary);
            }

            /* ==================== Áä∂ÊÄÅÊ∂àÊÅØ ==================== */
            .status-message {
                padding: 12px 16px;
                background: var(--icve-bg-glass);
                backdrop-filter: blur(8px);
                border-radius: 12px;
                font-size: 13px;
                color: var(--icve-text-secondary);
                text-align: center;
                margin-bottom: 12px;
                border: 1px solid var(--icve-border-subtle);
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                font-weight: 500;
            }

            .status-message:hover {
                border-color: var(--icve-border-default);
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            }

            /* ==================== È´òÁ∫ßËÆæÁΩÆ ==================== */
            .advanced-settings {
                margin: 12px 0;
                border: 2px solid var(--icve-border-default);
                border-radius: 12px;
                overflow: hidden;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .advanced-settings:hover {
                border-color: var(--icve-border-default);
            }

            .advanced-settings[open] {
                border-color: var(--icve-primary-via);
            }

            .advanced-settings summary {
                padding: 12px 16px;
                background: var(--icve-bg-sunken);
                cursor: pointer;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
                user-select: none;
                transition: all var(--icve-duration-normal) var(--icve-ease-out-expo);
                list-style: none;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .advanced-settings summary::-webkit-details-marker {
                display: none;
            }

            .advanced-settings summary::after {
                content: '‚ñ∏';
                margin-left: auto;
                transition: transform var(--icve-duration-normal) var(--icve-ease-out-expo);
            }

            .advanced-settings[open] summary::after {
                transform: rotate(90deg);
            }

            .advanced-settings summary:hover {
                background: var(--icve-bg-elevated);
                color: var(--icve-primary-via);
            }

            .advanced-content {
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                background: var(--icve-bg-glass);
                animation: advancedSlide 0.4s var(--icve-ease-out-expo);
            }

            @keyframes advancedSlide {
                from {
                    opacity: 0;
                    transform: translateY(-8px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .advanced-item {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .advanced-item label {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
            }

            .label-icon {
                font-size: 16px;
                line-height: 1;
            }

            .hint {
                font-size: 11px;
                color: var(--icve-text-tertiary);
                margin-top: 4px;
                font-weight: 500;
                letter-spacing: 0.2px;
            }

            /* ==================== Ê∑±Ëâ≤‰∏ªÈ¢ò ==================== */
            #icve-tabbed-panel.dark-theme {
                --icve-bg-base: #0f172a;
                --icve-bg-elevated: #1e293b;
                --icve-bg-sunken: #0c1322;
                --icve-bg-glass: rgba(30, 41, 59, 0.8);
                --icve-bg-glass-strong: rgba(30, 41, 59, 0.92);
                --icve-border-subtle: rgba(148, 163, 184, 0.12);
                --icve-border-default: rgba(148, 163, 184, 0.2);
                --icve-text-primary: #f1f5f9;
                --icve-text-secondary: #94a3b8;
                --icve-text-tertiary: #64748b;
                --icve-shadow-ambient: 0 8px 32px rgba(0, 0, 0, 0.3);
                --icve-shadow-elevated: 0 24px 48px rgba(0, 0, 0, 0.4);
                --icve-shadow-glow: 0 0 60px rgba(139, 92, 246, 0.25);
            }

            #icve-tabbed-panel.dark-theme .panel-container {
                box-shadow:
                    var(--icve-shadow-elevated),
                    var(--icve-shadow-glow),
                    inset 0 1px 1px rgba(255, 255, 255, 0.08);
            }

            #icve-tabbed-panel.dark-theme .panel-container::before {
                background: radial-gradient(
                    ellipse at 30% 20%,
                    rgba(99, 102, 241, 0.15) 0%,
                    transparent 50%
                ),
                radial-gradient(
                    ellipse at 70% 80%,
                    rgba(217, 70, 239, 0.12) 0%,
                    transparent 50%
                );
            }

            #icve-tabbed-panel.dark-theme .panel-container:hover {
                box-shadow:
                    0 32px 64px rgba(0, 0, 0, 0.5),
                    0 0 80px rgba(139, 92, 246, 0.3),
                    inset 0 1px 1px rgba(255, 255, 255, 0.08);
            }

            #icve-tabbed-panel.dark-theme .status-card-compact::before {
                background: linear-gradient(
                    90deg,
                    transparent,
                    rgba(255, 255, 255, 0.15),
                    transparent
                );
            }

            #icve-tabbed-panel.dark-theme .status-badge {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .progress-bar::before {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .tab-content-wrapper::-webkit-scrollbar-thumb {
                background: linear-gradient(
                    180deg,
                    rgba(99, 102, 241, 0.6),
                    rgba(217, 70, 239, 0.6)
                );
            }

            #icve-tabbed-panel.dark-theme .settings-section {
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
            }

            #icve-tabbed-panel.dark-theme .btn-toggle {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .input-with-unit {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .input-with-unit-inline {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .input-api-key {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .select-control,
            #icve-tabbed-panel.dark-theme .input-control {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .select-control:hover,
            #icve-tabbed-panel.dark-theme .input-control:hover {
                background: var(--icve-bg-elevated);
            }

            #icve-tabbed-panel.dark-theme .select-control:focus,
            #icve-tabbed-panel.dark-theme .input-control:focus {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .advanced-settings summary {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .advanced-settings summary:hover {
                background: var(--icve-bg-elevated);
            }

            /* Ê∑±Ëâ≤‰∏ªÈ¢ò - Á≠îÈ¢òÈ°µÈù¢ */
            #icve-tabbed-panel.dark-theme .exam-status-compact {
                background: rgba(30, 41, 59, 0.6);
            }

            #icve-tabbed-panel.dark-theme .exam-config-compact {
                background: rgba(30, 41, 59, 0.6);
            }

            #icve-tabbed-panel.dark-theme .config-row.config-key {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(52, 211, 153, 0.08));
                border-color: rgba(16, 185, 129, 0.2);
            }

            #icve-tabbed-panel.dark-theme .input-unit-mini {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .slider-mini {
                background: #475569;
            }

            #icve-tabbed-panel.dark-theme .advanced-mini summary {
                background: var(--icve-bg-base);
            }

            #icve-tabbed-panel.dark-theme .advanced-mini summary:hover {
                background: var(--icve-bg-elevated);
            }

            #icve-tabbed-panel.dark-theme .advanced-body {
                background: rgba(30, 41, 59, 0.6);
            }

            #icve-tabbed-panel.dark-theme .status-msg-mini {
                background: rgba(30, 41, 59, 0.6);
            }

            /* ==================== ÂÖºÂÆπÊóßÊ†∑Âºè ==================== */
            .status-card {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 18px;
                padding: 16px;
                margin-bottom: 16px;
                border: 1px solid var(--icve-border-subtle);
                box-shadow: var(--icve-shadow-ambient);
            }

            .status-row {
                display: flex;
                gap: 10px;
                margin-bottom: 8px;
            }

            .status-row:last-child {
                margin-bottom: 0;
            }

            .status-item {
                flex: 1;
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 12px;
                padding: 8px 12px;
                background: var(--icve-bg-elevated);
                border-radius: 10px;
            }

            .label {
                color: var(--icve-text-tertiary);
                font-weight: 600;
            }

            .value {
                font-weight: 700;
                font-size: 14px;
                color: var(--icve-text-primary);
                font-family: 'JetBrains Mono', monospace;
            }

            .value.short {
                max-width: 130px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .control-buttons {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 16px;
            }

            .progress-section {
                background: var(--icve-bg-glass);
                backdrop-filter: blur(12px);
                border-radius: 16px;
                padding: 16px;
                border: 1px solid var(--icve-border-subtle);
            }

            .progress-label {
                display: flex;
                align-items: center;
                gap: 6px;
                margin-bottom: 10px;
                font-size: 13px;
                color: var(--icve-text-secondary);
                font-weight: 600;
            }

            .progress-icon {
                font-size: 16px;
                line-height: 1;
            }

            .switches {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            /* ==================== È°µÈù¢Êó•ÂøóÊ†∑Âºè ==================== */
            .log-tab-container {
                display: flex;
                flex-direction: column;
                height: 100%;
                max-height: calc(92vh - 140px);
            }

            .log-container {
                flex: 1;
                overflow-y: auto;
                padding: 12px;
                background: var(--icve-bg-elevated);
                font-family: 'JetBrains Mono', monospace;
                font-size: 12px;
                scrollbar-width: thin;
                scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
                min-height: 280px;
            }

            .log-container::-webkit-scrollbar {
                width: 6px;
            }

            .log-container::-webkit-scrollbar-track {
                background: transparent;
            }

            .log-container::-webkit-scrollbar-thumb {
                background: linear-gradient(
                    180deg,
                    var(--icve-primary-from),
                    var(--icve-primary-to)
                );
                border-radius: 3px;
            }

            .log-footer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 16px;
                background: var(--icve-bg-glass);
                border-top: 1px solid var(--icve-border-subtle);
            }

            .log-count-text {
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-secondary);
            }

            .btn-clear-log {
                height: 34px;
                padding: 0 16px;
                font-size: 13px;
            }

            .log-entry {
                display: flex;
                align-items: flex-start;
                gap: 8px;
                padding: 8px 0;
                border-bottom: 1px solid var(--icve-border-subtle);
                animation: logEntryEnter 0.3s ease-out;
            }

            @keyframes logEntryEnter {
                from {
                    opacity: 0;
                    transform: translateX(20px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }

            .log-entry:last-child {
                border-bottom: none;
            }

            .log-time {
                color: var(--icve-text-tertiary);
                font-weight: 500;
                min-width: 70px;
            }

            .log-icon {
                font-size: 14px;
                line-height: 1;
            }

            .log-message {
                flex: 1;
                color: var(--icve-text-primary);
                word-break: break-word;
                line-height: 1.4;
            }

            .log-info .log-icon { color: var(--icve-info-from); }
            .log-success .log-icon { color: var(--icve-success-from); }
            .log-warn .log-icon { color: var(--icve-warning-from); }
            .log-error .log-icon { color: var(--icve-danger-from); }

            .log-info .log-message { color: var(--icve-text-primary); }
            .log-success .log-message { color: var(--icve-success-from); }
            .log-warn .log-message { color: var(--icve-warning-from); }
            .log-error .log-message { color: var(--icve-danger-from); font-weight: 600; }

            .log-placeholder {
                text-align: center;
                color: var(--icve-text-tertiary);
                padding: 40px 20px;
                font-style: italic;
            }

            .switch-item {
                display: flex;
                align-items: center;
                padding: 12px 14px;
                background: var(--icve-bg-elevated);
                border: 2px solid var(--icve-border-default);
                border-radius: 12px;
                cursor: pointer;
                transition: all var(--icve-duration-normal) var(--icve-ease-spring);
            }

            .switch-item:hover {
                border-color: var(--icve-primary-via);
                transform: translateX(4px);
                box-shadow: 0 4px 16px rgba(139, 92, 246, 0.15);
            }

            .switch-item input[type="checkbox"] {
                margin-right: 10px;
                width: 18px;
                height: 18px;
                cursor: pointer;
                accent-color: var(--icve-primary-via);
            }

            .switch-label {
                font-size: 14px;
                font-weight: 600;
                color: var(--icve-text-primary);
            }

            .settings-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .setting-row, .setting-row-full {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .setting-row-full {
                grid-column: span 2;
            }

            .setting-row label, .setting-row-full label {
                font-size: 12px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                text-transform: uppercase;
                letter-spacing: 0.3px;
            }

            .hint-info {
                color: var(--icve-info-from);
            }

            .hint-box {
                padding: 12px 14px;
                background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                border: 2px solid #fcd34d;
                border-radius: 12px;
                font-size: 13px;
                color: #92400e;
                margin-top: 8px;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(252, 211, 77, 0.25);
            }

            .ai-model-selector,
            .api-key-input,
            .exam-delay-setting {
                margin-bottom: 12px;
            }

            .model-label {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-primary);
                margin-bottom: 8px;
            }

            .select-large, .input-large {
                font-size: 14px;
                padding: 12px 14px;
            }

            .select-large {
                font-weight: 600;
                color: var(--icve-primary-via);
            }

            .input-large {
                font-family: 'JetBrains Mono', monospace;
            }

            .input-with-suffix {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .input-with-suffix .input-control {
                flex: 1;
                min-width: 0;
            }

            .input-suffix {
                font-size: 13px;
                font-weight: 600;
                color: var(--icve-text-tertiary);
                white-space: nowrap;
            }

            .question-bank-stats {
                margin-top: 16px;
                padding: 14px 16px;
                background: var(--icve-bg-glass);
                border-radius: 12px;
                border: 1px solid var(--icve-border-subtle);
            }

            .stats-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 6px 0;
                font-size: 13px;
            }

            .stats-label {
                color: var(--icve-text-secondary);
                font-weight: 600;
            }

            .stats-value {
                color: var(--icve-primary-via);
                font-weight: 700;
                font-size: 14px;
                font-family: 'JetBrains Mono', monospace;
            }
        `;
    document.head.appendChild(style);
  }
  function isExamNode(nodeElement) {
    const examButton = nodeElement.querySelector(".li_action .btn_dt");
    if (examButton) {
      const btnText = examButton.textContent.trim();
      if (btnText.includes("ÂºÄÂßãÁ≠îÈ¢ò") || btnText.includes("Á≠îÈ¢ò") || btnText.includes("ËÄÉËØï") || btnText.includes("ÊµãÈ™å")) {
        return true;
      }
    }
    return false;
  }
  function scanLearningNodes() {
    const nodes = document.querySelectorAll(".panelList .node");
    state.learning.allNodes = [];
    state.learning.completedCount = 0;
    state.learning.examCount = 0;
    state.learning.totalCount = nodes.length;
    nodes.forEach((node, index) => {
      const titleElement = node.querySelector(".title");
      const statusIcon = node.querySelector(".jd");
      const title = titleElement ? titleElement.textContent.trim() : `ËäÇÁÇπ${index + 1}`;
      const id = node.id;
      const isCompleted = statusIcon && statusIcon.classList.contains("wc") || state.learning.processedNodes.has(id);
      const isExam = isExamNode(node);
      if (isExam) {
        state.learning.examCount++;
      }
      state.learning.allNodes.push({
        element: node,
        id,
        title,
        isCompleted,
        isExam,
        index
      });
      if (isCompleted) {
        state.learning.completedCount++;
      }
    });
    const uncompletedCount = state.learning.totalCount - state.learning.completedCount;
    Logger.info(`Êâ´ÊèèÂÆåÊàê: ÂÖ±${state.learning.totalCount}‰∏™ËäÇÁÇπ, Â∑≤ÂÆåÊàê${state.learning.completedCount}‰∏™, ÂæÖÂ≠¶‰π†${uncompletedCount}‰∏™`);
    if (state.learning.examCount > 0) {
      Logger.info(`ÂèëÁé∞${state.learning.examCount}‰∏™ËÄÉËØïËäÇÁÇπ(Â∞ÜËá™Âä®Ë∑≥Ëøá)`);
    }
    updateLearningStatus();
  }
  function updateLearningStatus() {
    const progressText = `${state.learning.completedCount}/${state.learning.totalCount}`;
    const progressElement = document.getElementById("learning-progress");
    if (progressElement) {
      if (state.learning.examCount > 0) {
        progressElement.textContent = progressText;
        progressElement.title = `Ë∑≥Ëøá ${state.learning.examCount} ‰∏™ËÄÉËØï/ÊµãÈ™åËäÇÁÇπ`;
      } else {
        progressElement.textContent = progressText;
        progressElement.title = "";
      }
    }
    document.getElementById("learning-processed").textContent = state.learning.processedNodes.size;
    if (state.learning.currentNode && state.learning.currentNode.title) {
      const shortTitle = state.learning.currentNode.title.length > 18 ? state.learning.currentNode.title.substring(0, 18) + "..." : state.learning.currentNode.title;
      document.getElementById("learning-current").textContent = shortTitle;
      document.getElementById("learning-current").title = state.learning.currentNode.title;
    } else {
      document.getElementById("learning-current").textContent = "Êó†";
      document.getElementById("learning-current").title = "";
    }
  }
  function applyPlaybackRate() {
    const mediaElements = [
      ...document.querySelectorAll("audio"),
      ...document.querySelectorAll("video")
    ];
    mediaElements.forEach((media) => {
      media.playbackRate = CONFIG.learning.playbackRate;
    });
  }
  function applyMuteToCurrentMedia() {
    const mediaElements = [
      ...document.querySelectorAll("audio"),
      ...document.querySelectorAll("video")
    ];
    mediaElements.forEach((media) => {
      media.muted = CONFIG.learning.muteMedia;
    });
  }
  function resetLearning() {
    if (confirm("Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂ∑≤Â§ÑÁêÜËäÇÁÇπÁöÑËÆ∞ÂΩïÂêóÔºü")) {
      state.learning.processedNodes.clear();
      if (state.learning.completedChapters) {
        state.learning.completedChapters.clear();
      }
      saveLearningProgress();
      scanLearningNodes();
      Logger.warn("Â∑≤ÈáçÁΩÆÊâÄÊúâÂ≠¶‰π†ËøõÂ∫¶");
    }
  }
  function updateLearningProgressText(text) {
    const progressText = document.getElementById("learning-progress-text");
    if (progressText) {
      progressText.textContent = text;
    }
  }
  async function fetchChapterContentByAPI(chapterId) {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const courseInfoId = urlParams.get("courseInfoId");
      const courseId = urlParams.get("courseId");
      if (!courseInfoId || !courseId) {
        return null;
      }
      const apiUrl = `https://ai.icve.com.cn/prod-api/course/courseDesign/getCellList?courseInfoId=${courseInfoId}&courseId=${courseId}&parentId=${chapterId}`;
      const response = await fetch(apiUrl, {
        method: "GET",
        headers: {
          "Accept": "application/json, text/plain, */*",
          "Content-Type": "application/json"
        },
        credentials: "include"
      });
      if (!response.ok) {
        return null;
      }
      const data = await response.json();
      return data;
    } catch (error) {
      return null;
    }
  }
  async function expandNextUncompletedSection() {
    updateLearningProgressText("üîç Ê≠£Âú®Êü•Êâæ‰∏ã‰∏Ä‰∏™Á´†ËäÇ...");
    const sections = document.querySelectorAll(".one > .draggablebox > span > .collapse-panel");
    for (let section of sections) {
      const panelTitle = section.querySelector(".panel-title");
      const panelContent = section.querySelector(".panel-content");
      if (!panelTitle || !panelContent) continue;
      if (panelContent.style.display !== "none") {
        const nodes = section.querySelectorAll(".panelList .node");
        if (nodes.length > 0) {
          const allCompleted = Array.from(nodes).every((node) => {
            const statusIcon = node.querySelector(".jd");
            const id = node.id;
            const isExam = isExamNode(node);
            return statusIcon && statusIcon.classList.contains("wc") || state.learning.processedNodes.has(id) || isExam;
          });
          if (allCompleted) {
            const chapterId = section.id;
            if (!state.learning.completedChapters) {
              state.learning.completedChapters = /* @__PURE__ */ new Set();
            }
            state.learning.completedChapters.add(chapterId);
            saveLearningProgress();
            continue;
          } else {
            return false;
          }
        }
      } else {
        const chapterId = section.id;
        if (state.learning.completedChapters && state.learning.completedChapters.has(chapterId)) {
          continue;
        }
        const titleText = panelTitle.textContent.trim().substring(0, 40);
        updateLearningProgressText(`üìÇ Ê≠£Âú®Â±ïÂºÄÊñ∞Á´†ËäÇÔºö${titleText}...`);
        await fetchChapterContentByAPI(chapterId);
        await Utils.sleep(500);
        const arrow = panelTitle.querySelector(".jiantou");
        if (arrow) {
          arrow.click();
          await Utils.sleep(800);
        }
        await Utils.sleep(2e3);
        let nodes = section.querySelectorAll(".panelList .node");
        let retryCount = 0;
        const maxRetries = 5;
        while (nodes.length === 0 && retryCount < maxRetries) {
          await Utils.sleep(1500);
          nodes = section.querySelectorAll(".panelList .node");
          retryCount++;
          if (nodes.length === 0 && retryCount === 2) {
            const arrow2 = panelTitle.querySelector(".jiantou");
            if (arrow2) {
              arrow2.click();
              await Utils.sleep(1e3);
            }
          }
        }
        updateLearningProgressText(`‚úÖ Á´†ËäÇÂ±ïÂºÄÊàêÂäüÔºåÂèëÁé∞ ${nodes.length} ‰∏™ËäÇÁÇπ`);
        Logger.info(`Â±ïÂºÄÊñ∞Á´†ËäÇ: ÂèëÁé∞${nodes.length}‰∏™ËäÇÁÇπ`);
        if (nodes.length > 0) {
          return true;
        } else {
          if (!state.learning.completedChapters) {
            state.learning.completedChapters = /* @__PURE__ */ new Set();
          }
          state.learning.completedChapters.add(chapterId);
          saveLearningProgress();
          continue;
        }
      }
    }
    return false;
  }
  function getDocumentPageInfo() {
    const pageDiv = document.querySelector(".page");
    if (!pageDiv) return null;
    const match = pageDiv.textContent.match(/(\d+)\s*\/\s*(\d+)/);
    if (match) {
      return {
        current: parseInt(match[1]),
        total: parseInt(match[2])
      };
    }
    return null;
  }
  function clickNextPage() {
    const buttons = document.querySelectorAll(".page button");
    for (let btn of buttons) {
      const span = btn.querySelector("span");
      if (span && span.textContent.includes("‰∏ã‰∏ÄÈ°µ")) {
        btn.click();
        return true;
      }
    }
    return false;
  }
  function handleDocument() {
    const pageInfo = getDocumentPageInfo();
    if (pageInfo) {
      state.learning.currentPage = pageInfo.current;
      state.learning.totalPages = pageInfo.total;
      const percentage = pageInfo.current / pageInfo.total * 100;
      const progressBar = document.getElementById("learning-progress-bar");
      if (progressBar) {
        progressBar.style.width = `${percentage}%`;
        progressBar.setAttribute("data-progress", `${Math.round(percentage)}%`);
      }
      updateLearningProgressText(`ÊñáÊ°£: Á¨¨ ${pageInfo.current}/${pageInfo.total} È°µ`);
      if (pageInfo.current < pageInfo.total) {
        setTimeout(() => {
          if (clickNextPage()) {
            setTimeout(() => {
              handleDocument();
            }, 2e3);
          }
        }, CONFIG.learning.documentPageInterval * 1e3);
      } else {
        updateLearningProgressText("ÊñáÊ°£Â∑≤ÊµèËßàÂÆåÊàê");
        Logger.success(`ÊñáÊ°£ÊµèËßàÂÆåÊàê(ÂÖ±${pageInfo.total}È°µ)`);
        state.learning.isDocument = false;
        setTimeout(() => {
          const progressBar2 = document.getElementById("learning-progress-bar");
          if (progressBar2) {
            progressBar2.style.width = "0%";
          }
        }, 1e3);
        if (state.learning.currentNode && state.learning.currentNode.id) {
          state.learning.processedNodes.add(state.learning.currentNode.id);
          saveLearningProgress();
          updateLearningStatus();
        }
        if (state.learning.isRunning) {
          setTimeout(() => {
            goToNextNode();
          }, CONFIG.learning.waitTimeAfterComplete * 1e3);
        }
      }
    } else {
      updateLearningProgressText("ÂçïÈ°µÊñáÊ°£Â∑≤ÊµèËßà");
      Logger.success("ÂçïÈ°µÊñáÊ°£ÊµèËßàÂÆåÊàê");
      state.learning.isDocument = false;
      if (state.learning.currentNode && state.learning.currentNode.id) {
        state.learning.processedNodes.add(state.learning.currentNode.id);
        saveLearningProgress();
        updateLearningStatus();
      }
      if (state.learning.isRunning) {
        setTimeout(() => {
          goToNextNode();
        }, CONFIG.learning.waitTimeAfterComplete * 1e3);
      }
    }
  }
  function hideContinuePlayDialog() {
    const dialogs = document.querySelectorAll(".el-message-box__wrapper");
    for (let dialog of dialogs) {
      if (dialog.style.display === "none") continue;
      const dialogText = (dialog.textContent || "").replace(/\s+/g, " ");
      if (dialogText.includes("ÁªßÁª≠Êí≠Êîæ") || dialogText.includes("ÊòØÂê¶ÁªßÁª≠") && dialogText.includes("Êí≠Êîæ")) {
        dialog.style.display = "none";
        Logger.info('Â∑≤ÈöêËóè"ÁªßÁª≠Êí≠Êîæ"ÊèêÁ§∫Ê°Ü');
        return true;
      }
    }
    return false;
  }
  function playMedia(mediaElements) {
    mediaElements.forEach((media, index) => {
      if (media.dataset.processed) return;
      media.dataset.processed = "true";
      const mediaType = media.tagName.toLowerCase() === "video" ? "ËßÜÈ¢ë" : "Èü≥È¢ë";
      media.playbackRate = CONFIG.learning.playbackRate;
      media.muted = CONFIG.learning.muteMedia;
      updateLearningProgressText(`${mediaType}Êí≠Êîæ‰∏≠...`);
      media.addEventListener("timeupdate", () => {
        if (media.duration > 0) {
          const current = media.currentTime;
          const total = media.duration;
          const percentage = current / total * 100;
          const progressBar = document.getElementById("learning-progress-bar");
          if (progressBar) {
            progressBar.style.width = `${percentage}%`;
            progressBar.setAttribute("data-progress", `${Math.round(percentage)}%`);
          }
          updateLearningProgressText(`${mediaType}: ${Utils.formatTime(current)} / ${Utils.formatTime(total)}`);
        }
      });
      media.addEventListener("ended", () => {
        state.learning.mediaWatching = false;
        Logger.success(`${mediaType}Êí≠ÊîæÂÆåÊàê`);
        if (state.learning.currentNode && state.learning.currentNode.id) {
          state.learning.processedNodes.add(state.learning.currentNode.id);
          saveLearningProgress();
          updateLearningStatus();
        }
        const progressBar = document.getElementById("learning-progress-bar");
        if (progressBar) {
          progressBar.style.width = "0%";
        }
        updateLearningProgressText(`${mediaType}Â∑≤ÂÆåÊàê`);
        if (state.learning.isRunning) {
          setTimeout(() => {
            goToNextNode();
          }, CONFIG.learning.waitTimeAfterComplete * 1e3);
        }
      });
      state.learning.mediaWatching = true;
      media.play().catch((err) => {
        state.learning.mediaWatching = false;
        Logger.error("Â™í‰ΩìÊí≠ÊîæÂ§±Ë¥•: " + err.message);
      });
    });
  }
  function detectContentType() {
    const examButton = document.querySelector(".li_action .btn_dt, .btn_dt");
    if (examButton) {
      const btnText = examButton.textContent.trim();
      if (btnText.includes("ÂºÄÂßãÁ≠îÈ¢ò") || btnText.includes("Á≠îÈ¢ò") || btnText.includes("ËÄÉËØï") || btnText.includes("ÊµãÈ™å")) {
        updateLearningProgressText("‚è≠Ô∏è Ê£ÄÊµãÂà∞ËÄÉËØïÈ°µÈù¢ÔºåÂ∑≤Ë∑≥Ëøá");
        Logger.warn("Ë∑≥ËøáËÄÉËØïËäÇÁÇπ");
        if (state.learning.currentNode && state.learning.currentNode.id) {
          state.learning.processedNodes.add(state.learning.currentNode.id);
          saveLearningProgress();
          updateLearningStatus();
        }
        if (state.learning.isRunning) {
          setTimeout(() => {
            goToNextNode();
          }, 1e3);
        }
        return;
      }
    }
    const mediaElements = [
      ...document.querySelectorAll("audio"),
      ...document.querySelectorAll("video")
    ];
    if (mediaElements.length === 0) {
      updateLearningProgressText("Ê£ÄÊµãÂà∞ÊñáÊ°£ÔºåÂáÜÂ§áÊµèËßà...");
      Logger.info("Ê£ÄÊµãÂà∞ÊñáÊ°£Á±ªÂûãÂÜÖÂÆπ");
      state.learning.isDocument = true;
      setTimeout(() => {
        handleDocument();
      }, 1e3);
      return;
    }
    state.learning.isDocument = false;
    const mediaType = mediaElements[0].tagName.toLowerCase() === "video" ? "ËßÜÈ¢ë" : "Èü≥È¢ë";
    Logger.info(`Ê£ÄÊµãÂà∞${mediaType}ÂÜÖÂÆπÔºåÂºÄÂßãÊí≠Êîæ`);
    playMedia(mediaElements);
  }
  async function clickNode(nodeInfo) {
    state.learning.currentNode = nodeInfo;
    updateLearningStatus();
    const progressBar = document.getElementById("learning-progress-bar");
    if (progressBar) {
      progressBar.style.width = "0%";
    }
    updateLearningProgressText("Ê≠£Âú®Âä†ËΩΩÂÜÖÂÆπ...");
    const shortTitle = nodeInfo.title.length > 25 ? nodeInfo.title.substring(0, 25) + "..." : nodeInfo.title;
    Logger.info(`ÂºÄÂßãÂ≠¶‰π†: ${shortTitle}`);
    if (nodeInfo.element) {
      nodeInfo.element.click();
      setTimeout(() => {
        detectContentType();
      }, 3e3);
    }
  }
  async function goToNextNode() {
    scanLearningNodes();
    const uncompletedNodes = state.learning.allNodes.filter((n) => !n.isCompleted);
    if (uncompletedNodes.length === 0) {
      updateLearningProgressText("üéØ ÂΩìÂâçÁ´†ËäÇÂ∑≤ÂÆåÊàêÔºåÊ≠£Âú®Êü•Êâæ‰∏ã‰∏ÄÁ´†ËäÇ...");
      const foundNewSection = await expandNextUncompletedSection();
      if (foundNewSection) {
        scanLearningNodes();
        const newUncompletedNodes = state.learning.allNodes.filter((n) => !n.isCompleted);
        if (newUncompletedNodes.length > 0) {
          const nextNode2 = newUncompletedNodes[0];
          if (nextNode2.isExam) {
            updateLearningProgressText(`‚è≠Ô∏è Ë∑≥ËøáËÄÉËØïËäÇÁÇπÔºö${nextNode2.title.substring(0, 20)}...`);
            state.learning.processedNodes.add(nextNode2.id);
            saveLearningProgress();
            updateLearningStatus();
            setTimeout(() => {
              goToNextNode();
            }, 500);
            return;
          }
          setTimeout(() => {
            clickNode(nextNode2);
          }, 1e3);
        } else {
          setTimeout(() => {
            goToNextNode();
          }, 1e3);
        }
      } else {
        updateLearningProgressText("üéâ ÊâÄÊúâÁ´†ËäÇÂ∑≤ÂÆåÊàêÔºÅ");
        Logger.success("ÊâÄÊúâÂ≠¶‰π†ÂÜÖÂÆπÂ∑≤ÂÆåÊàêÔºÅ");
        state.learning.isRunning = false;
        document.getElementById("learning-start").disabled = false;
        document.getElementById("learning-status").textContent = "Â∑≤ÂÆåÊàê";
        const statusDot = document.getElementById("learning-status-dot");
        if (statusDot) {
          statusDot.classList.remove("running");
          statusDot.classList.add("completed");
        }
      }
      return;
    }
    const nextNode = uncompletedNodes[0];
    if (nextNode.isExam) {
      updateLearningProgressText(`‚è≠Ô∏è Ë∑≥ËøáËÄÉËØïËäÇÁÇπÔºö${nextNode.title.substring(0, 20)}...`);
      state.learning.processedNodes.add(nextNode.id);
      saveLearningProgress();
      updateLearningStatus();
      setTimeout(() => {
        goToNextNode();
      }, 500);
      return;
    }
    setTimeout(() => {
      clickNode(nextNode);
    }, 1e3);
  }
  function startLearning() {
    if (state.learning.isRunning) return;
    state.learning.isRunning = true;
    document.getElementById("learning-start").disabled = true;
    document.getElementById("learning-status").textContent = "ËøêË°å‰∏≠";
    const statusDot = document.getElementById("learning-status-dot");
    if (statusDot) statusDot.classList.add("running");
    setTimeout(() => {
      hideContinuePlayDialog();
    }, 500);
    Logger.info("ÂºÄÂßãËá™Âä®Â≠¶‰π†");
    scanLearningNodes();
    setTimeout(() => {
      goToNextNode();
    }, 1e3);
  }
  function getAIConfig() {
    return ConfigManager.getAIConfig(CONFIG.exam.currentAI);
  }
  function getCurrentQuestion() {
    const questionEl = document.querySelector(".single, .multiple, .judge, .fill, .completion");
    if (!questionEl) return null;
    const typeMap = {
      "single": "ÂçïÈÄâÈ¢ò",
      "multiple": "Â§öÈÄâÈ¢ò",
      "judge": "Âà§Êñ≠È¢ò",
      "fill": "Â°´Á©∫È¢ò",
      "completion": "Â°´Á©∫È¢ò"
    };
    let questionType = "Êú™Áü•";
    for (const [cls, type] of Object.entries(typeMap)) {
      if (questionEl.classList.contains(cls)) {
        questionType = type;
        break;
      }
    }
    const titleEl = questionEl.querySelector(".single-title-content, .multiple-title-content, .judge-title-content, .fill-title-content, .completion-title-content");
    const questionText = titleEl ? titleEl.textContent.trim() : "";
    const options = [];
    const optionEls = questionEl.querySelectorAll(".ivu-radio-wrapper, .ivu-checkbox-wrapper");
    optionEls.forEach((optionEl, index) => {
      const optionLabel = String.fromCharCode(65 + index);
      const optionTextEl = optionEl.querySelector("span:last-child");
      const optionText = optionTextEl ? optionTextEl.textContent.trim() : "";
      options.push({ label: optionLabel, text: optionText, element: optionEl });
    });
    let fillInputs = [];
    if (questionType === "Â°´Á©∫È¢ò") {
      fillInputs = Array.from(questionEl.querySelectorAll('input[type="text"], textarea, .ivu-input'));
    }
    return { type: questionType, text: questionText, options, fillInputs, element: questionEl };
  }
  function buildPrompt(question) {
    let prompt = "";
    if (question.type === "ÂçïÈÄâÈ¢ò") {
      prompt = `ËøôÊòØ‰∏ÄÈÅìÂçïÈÄâÈ¢òÔºåËØ∑‰ªîÁªÜÂàÜÊûêÂêéÈÄâÊã©Ê≠£Á°ÆÁ≠îÊ°à„ÄÇ

È¢òÁõÆÔºö${question.text}

ÈÄâÈ°πÔºö
`;
      question.options.forEach((opt) => {
        prompt += `${opt.label}. ${opt.text}
`;
      });
      prompt += `
ËØ∑Áõ¥Êé•ÂõûÁ≠îÈÄâÈ°πÂ≠óÊØçÔºàÂ¶ÇÔºöA Êàñ B Êàñ C Êàñ DÔºâÔºå‰∏çË¶ÅÊúâÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ`;
    } else if (question.type === "Â§öÈÄâÈ¢ò") {
      prompt = `ËøôÊòØ‰∏ÄÈÅìÂ§öÈÄâÈ¢òÔºåËØ∑‰ªîÁªÜÂàÜÊûêÂêéÈÄâÊã©ÊâÄÊúâÊ≠£Á°ÆÁ≠îÊ°à„ÄÇ

È¢òÁõÆÔºö${question.text}

ÈÄâÈ°πÔºö
`;
      question.options.forEach((opt) => {
        prompt += `${opt.label}. ${opt.text}
`;
      });
      prompt += `
ËØ∑Áõ¥Êé•ÂõûÁ≠îÈÄâÈ°πÂ≠óÊØçÔºåÂ§ö‰∏™Á≠îÊ°àÁî®ÈÄóÂè∑ÂàÜÈöîÔºàÂ¶ÇÔºöA,C,DÔºâÔºå‰∏çË¶ÅÊúâÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ`;
    } else if (question.type === "Âà§Êñ≠È¢ò") {
      prompt = `ËøôÊòØ‰∏ÄÈÅìÂà§Êñ≠È¢òÔºåËØ∑Âà§Êñ≠ÂØπÈîô„ÄÇ

È¢òÁõÆÔºö${question.text}

`;
      if (question.options.length > 0) {
        prompt += `ÈÄâÈ°πÔºö
`;
        question.options.forEach((opt) => {
          prompt += `${opt.label}. ${opt.text}
`;
        });
        prompt += `
ËØ∑Áõ¥Êé•ÂõûÁ≠îÈÄâÈ°πÂ≠óÊØçÔºàÂ¶ÇÔºöA Êàñ BÔºâÔºå‰∏çË¶ÅÊúâÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ`;
      } else {
        prompt += `
ËØ∑Áõ¥Êé•ÂõûÁ≠î"ÂØπ"Êàñ"Èîô"Ôºå‰∏çË¶ÅÊúâÂÖ∂‰ªñÂÜÖÂÆπ„ÄÇ`;
      }
    } else if (question.type === "Â°´Á©∫È¢ò") {
      prompt = `ËøôÊòØ‰∏ÄÈÅìÂ°´Á©∫È¢òÔºåËØ∑ÁªôÂá∫ÂáÜÁ°ÆÁ≠îÊ°à„ÄÇ

È¢òÁõÆÔºö${question.text}

`;
      if (question.options && question.options.length > 0) {
        prompt += `ÂèÇËÄÉÈÄâÈ°πÔºö
`;
        question.options.forEach((opt) => {
          prompt += `${opt.label}. ${opt.text}
`;
        });
        prompt += `
`;
      }
      const blankCount = question.fillInputs.length;
      if (blankCount > 1) {
        prompt += `Ê≥®ÊÑèÔºöËøôÈÅìÈ¢òÊúâ ${blankCount} ‰∏™Á©∫ÈúÄË¶ÅÂ°´ÂÜô„ÄÇ
`;
        prompt += `ËØ∑ÊåâÈ°∫Â∫èÁªôÂá∫ÊâÄÊúâÁ©∫ÁöÑÁ≠îÊ°àÔºåÊØè‰∏™Á≠îÊ°à‰πãÈó¥Áî®ÂàÜÂè∑(;)ÂàÜÈöî„ÄÇ
‰æãÂ¶ÇÔºöÁ≠îÊ°à1;Á≠îÊ°à2;Á≠îÊ°à3

`;
      }
      prompt += `Ë¶ÅÊ±ÇÔºö
1. Âè™ËøîÂõûÁ≠îÊ°àÂÜÖÂÆπÔºå‰∏çË¶ÅÊúâ‰ªª‰ΩïËß£ÈáäÊàñÂÖ∂‰ªñÊñáÂ≠ó
2. Â¶ÇÊûúÊúâÂ§ö‰∏™Á©∫ÔºåÂä°ÂøÖÁî®ÂàÜÂè∑(;)ÂàÜÈöî
3. Á≠îÊ°àË¶ÅÂáÜÁ°ÆÁÆÄÊ¥Å`;
    }
    return prompt;
  }
  function askAI(question) {
    return new Promise((resolve, reject) => {
      const aiConfig = getAIConfig();
      const prompt = buildPrompt(question);
      Logger.info(`Ê≠£Âú®ËØ∑Ê±ÇAI...`);
      const requestBody = {
        model: aiConfig.model,
        messages: [
          {
            role: "system",
            content: "‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑÁ≠îÈ¢òÂä©Êâã„ÄÇ‰Ω†ÈúÄË¶ÅÊ†πÊçÆÈ¢òÁõÆÂÜÖÂÆπÔºåÁªôÂá∫ÂáÜÁ°ÆÁöÑÁ≠îÊ°à„ÄÇËØ∑‰∏•Ê†ºÊåâÁÖßË¶ÅÊ±ÇÁöÑÊ†ºÂºèËøîÂõûÁ≠îÊ°à„ÄÇ"
          },
          { role: "user", content: prompt }
        ],
        temperature: 0.1,
        max_tokens: 500
      };
      const timeoutId = setTimeout(() => {
        reject(new Error("ËØ∑Ê±ÇË∂ÖÊó∂Ôºà30ÁßíÔºâ"));
      }, 3e4);
      GM_xmlhttpRequest({
        method: "POST",
        url: `${aiConfig.baseURL}/chat/completions`,
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${aiConfig.apiKey}`
        },
        data: JSON.stringify(requestBody),
        timeout: 3e4,
        onload: function(response) {
          var _a;
          clearTimeout(timeoutId);
          try {
            if (response.status !== 200) {
              let errorMsg = `APIÈîôËØØ(${response.status})`;
              try {
                const errorData = JSON.parse(response.responseText);
                errorMsg = ((_a = errorData.error) == null ? void 0 : _a.message) || errorData.message || errorMsg;
              } catch (e) {
                errorMsg = `APIËøîÂõûÈîôËØØ: ${response.status} ${response.statusText}`;
              }
              Logger.error("APIÈîôËØØ:", errorMsg);
              reject(new Error(errorMsg));
              return;
            }
            const data = JSON.parse(response.responseText);
            if (data.choices && data.choices.length > 0) {
              const answer = data.choices[0].message.content.trim();
              resolve(answer);
            } else if (data.error) {
              reject(new Error(data.error.message || "APIËøîÂõûÈîôËØØ"));
            } else {
              reject(new Error("AIËøîÂõûÊï∞ÊçÆÊ†ºÂºèÈîôËØØ"));
            }
          } catch (error) {
            Logger.error("Ëß£ÊûêÂìçÂ∫îÂ§±Ë¥•:", error);
            reject(new Error("Ëß£ÊûêAIËøîÂõûÊï∞ÊçÆÂ§±Ë¥•"));
          }
        },
        onerror: (err) => {
          clearTimeout(timeoutId);
          Logger.error("ÁΩëÁªúÈîôËØØ:", err);
          reject(new Error("ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•"));
        },
        ontimeout: () => {
          clearTimeout(timeoutId);
          reject(new Error("ËØ∑Ê±ÇË∂ÖÊó∂"));
        }
      });
    });
  }
  async function searchAnswer(question) {
    try {
      const aiConfig = getAIConfig();
      if (!aiConfig.apiKey || aiConfig.apiKey === "") {
        updateExamMessage("ËØ∑ÂÖàÈÖçÁΩÆAPI Key", "#ef4444");
        return null;
      }
      updateExamMessage(`üì° Ê≠£Âú®‰ΩøÁî® ${AI_PRESETS[CONFIG.exam.currentAI].name} Êü•ËØ¢...`, "#2196F3");
      const answer = await Utils.retry(
        () => askAI(question),
        2,
        // ÊúÄÂ§öÈáçËØï2Ê¨°
        1500
        // ÈáçËØïÈó¥Èöî1.5Áßí
      );
      return answer;
    } catch (error) {
      Logger.error("Êü•ËØ¢Â§±Ë¥•:", error.message);
      updateExamMessage("‚ùå Êü•ËØ¢Â§±Ë¥•: " + error.message, "#ef4444");
      return null;
    }
  }
  async function selectAnswer(question, answer) {
    if (!answer) {
      updateExamMessage("Êú™ÊâæÂà∞Á≠îÊ°àÔºåË∑≥ËøáÊ≠§È¢ò", "#f59e0b");
      return false;
    }
    try {
      if (question.type === "ÂçïÈÄâÈ¢ò" || question.type === "Âà§Êñ≠È¢ò") {
        const matchedOption = question.options.find((opt) => {
          return answer.includes(opt.label) || answer.includes(opt.text) || opt.text.includes(answer);
        });
        if (matchedOption) {
          const radioInput = matchedOption.element.querySelector('input[type="radio"]');
          if (radioInput) {
            radioInput.click();
            updateExamMessage(`Â∑≤ÈÄâÊã©Á≠îÊ°àÔºö${matchedOption.label}`, "#10b981");
            return true;
          }
        }
      } else if (question.type === "Â§öÈÄâÈ¢ò") {
        const answerLabels = answer.match(/[A-Z]/g) || [];
        let selectedCount = 0;
        for (let i = 0; i < answerLabels.length; i++) {
          const label = answerLabels[i];
          const matchedOption = question.options.find((opt) => opt.label === label);
          if (matchedOption) {
            let checkboxInput = matchedOption.element.querySelector('input[type="checkbox"]');
            if (!checkboxInput) {
              checkboxInput = matchedOption.element.querySelector(".ivu-checkbox-input");
            }
            if (!checkboxInput) {
              matchedOption.element.click();
              selectedCount++;
            } else if (!checkboxInput.checked) {
              checkboxInput.click();
              selectedCount++;
            }
            await Utils.sleep(200);
          }
        }
        if (selectedCount > 0) {
          updateExamMessage(`Â∑≤ÈÄâÊã©Á≠îÊ°àÔºö${answerLabels.join(", ")}`, "#10b981");
          return true;
        }
      } else if (question.type === "Â°´Á©∫È¢ò") {
        if (question.fillInputs.length > 0) {
          const answers = answer.split(/[;Ôºõ]/).map((a) => a.trim()).filter((a) => a);
          let filledCount = 0;
          question.fillInputs.forEach((input, index) => {
            if (answers[index]) {
              input.value = answers[index];
              input.dispatchEvent(new Event("input", { bubbles: true }));
              input.dispatchEvent(new Event("change", { bubbles: true }));
              input.dispatchEvent(new Event("blur", { bubbles: true }));
              filledCount++;
            }
          });
          if (filledCount > 0) {
            updateExamMessage(`Â∑≤Â°´ÂÖ• ${filledCount} ‰∏™Á≠îÊ°à`, "#10b981");
            return true;
          }
        }
      }
      updateExamMessage("Á≠îÊ°àÊ†ºÂºè‰∏çÂåπÈÖçÔºåË∑≥ËøáÊ≠§È¢ò", "#f59e0b");
      return false;
    } catch (error) {
      return false;
    }
  }
  function clickNextButton() {
    const nextBtn = Array.from(document.querySelectorAll("button")).find((btn) => btn.textContent.includes("‰∏ã‰∏ÄÈ¢ò"));
    if (nextBtn && !nextBtn.disabled) {
      setTimeout(() => {
        nextBtn.click();
        updateExamMessage("Â∑≤ÁÇπÂáª‰∏ã‰∏ÄÈ¢ò", "#2196F3");
      }, 500);
      return true;
    }
    return false;
  }
  async function clickSubmitButton() {
    const submitBtn = Array.from(document.querySelectorAll("button")).find((btn) => btn.textContent.includes("‰∫§Âç∑"));
    if (submitBtn && !submitBtn.disabled) {
      if (CONFIG.exam.autoSubmit) {
        updateExamMessage("Ê≠£Âú®Ëá™Âä®‰∫§Âç∑...", "#10b981");
        await Utils.sleep(1e3);
        submitBtn.click();
        await Utils.sleep(1500);
        const confirmed = await clickConfirmSubmit();
        if (confirmed) {
          updateExamMessage("Â∑≤Ëá™Âä®Á°ÆËÆ§Êèê‰∫§", "#10b981");
        }
      } else {
        updateExamMessage("ÊâÄÊúâÈ¢òÁõÆÂ∑≤ÂÆåÊàêÔºåËØ∑ÊâãÂä®‰∫§Âç∑", "#10b981");
      }
      return true;
    }
    return false;
  }
  async function clickConfirmSubmit() {
    for (let i = 0; i < 10; i++) {
      let confirmBtn = Array.from(document.querySelectorAll("button")).find((btn) => btn.textContent.includes("Á°ÆËÆ§Êèê‰∫§"));
      if (!confirmBtn) {
        const footer = document.querySelector(".ivu-modal-confirm-footer");
        if (footer) confirmBtn = footer.querySelector(".ivu-btn-primary");
      }
      if (!confirmBtn) {
        const modal = document.querySelector(".ivu-modal-confirm");
        if (modal) confirmBtn = modal.querySelector(".ivu-btn-primary");
      }
      if (confirmBtn) {
        await Utils.sleep(500);
        confirmBtn.click();
        await Utils.sleep(2e3);
        await clickClosePage();
        return true;
      }
      await Utils.sleep(100);
    }
    return false;
  }
  async function clickClosePage() {
    for (let i = 0; i < 15; i++) {
      let closeBtn = Array.from(document.querySelectorAll("button")).find(
        (btn) => btn.textContent.includes("ÂÖ≥Èó≠È°µÈù¢") || btn.textContent.includes("ÂÖ≥Èó≠")
      );
      if (!closeBtn) {
        const footer = document.querySelector(".ivu-modal-confirm-footer");
        if (footer) {
          const primaryBtn = footer.querySelector(".ivu-btn-primary");
          if (primaryBtn && (primaryBtn.textContent.includes("ÂÖ≥Èó≠") || primaryBtn.textContent.includes("Á°ÆÂÆö"))) {
            closeBtn = primaryBtn;
          }
        }
      }
      if (closeBtn) {
        await Utils.sleep(500);
        closeBtn.click();
        updateExamMessage("Â∑≤ÂÆåÊàêÂπ∂ÂÖ≥Èó≠È°µÈù¢", "#10b981");
        return true;
      }
      await Utils.sleep(200);
    }
    return false;
  }
  async function answerQuestions() {
    while (state.exam.isRunning) {
      try {
        const question = getCurrentQuestion();
        if (!question || !question.text) {
          const submitted = await clickSubmitButton();
          if (submitted) break;
          await Utils.sleep(2e3);
          break;
        }
        state.exam.currentQuestionIndex++;
        updateExamProgress();
        const shortQuestion = question.text.length > 50 ? question.text.substring(0, 50) + "..." : question.text;
        Logger.info(`„ÄêÁ¨¨${state.exam.currentQuestionIndex}È¢ò-${question.type}„Äë${shortQuestion}`);
        if (question.options.length > 0) {
          const optionsText = question.options.map((opt) => `${opt.label}.${opt.text}`).join(" | ");
          const shortOptions = optionsText.length > 80 ? optionsText.substring(0, 80) + "..." : optionsText;
          Logger.info(`ÈÄâÈ°π: ${shortOptions}`);
        }
        updateExamMessage(`Ê≠£Âú®Â§ÑÁêÜÁ¨¨ ${state.exam.currentQuestionIndex} È¢ò (${question.type})...`, "#2196F3");
        const answer = await searchAnswer(question);
        if (answer) {
          Logger.success(`AIÁ≠îÊ°à: ${answer}`);
          await selectAnswer(question, answer);
          updateExamMessage(`‚úÖ Á¨¨ ${state.exam.currentQuestionIndex} È¢òÂ∑≤ÂÆåÊàê`, "#10b981");
        } else {
          Logger.warn(`Á¨¨${state.exam.currentQuestionIndex}È¢òÊú™Ëé∑ÂèñÂà∞Á≠îÊ°à`);
          updateExamMessage(`‚ö†Ô∏è Á¨¨ ${state.exam.currentQuestionIndex} È¢òÊú™ÊâæÂà∞Á≠îÊ°àÔºåË∑≥Ëøá`, "#f59e0b");
        }
        await Utils.sleep(CONFIG.exam.delay);
        const hasNext = clickNextButton();
        if (!hasNext) {
          await Utils.sleep(1e3);
          await clickSubmitButton();
          break;
        }
        await Utils.sleep(1e3);
      } catch (error) {
        Logger.error("Á≠îÈ¢òÂá∫Èîô:", error);
        updateExamMessage(`‚ùå Á¨¨ ${state.exam.currentQuestionIndex} È¢òÂá∫Èîô: ${error.message}`, "#ef4444");
        await Utils.sleep(2e3);
        const hasNext = clickNextButton();
        if (!hasNext) break;
        await Utils.sleep(1e3);
      }
    }
    state.exam.isRunning = false;
    document.getElementById("exam-start").disabled = false;
    document.getElementById("exam-stop").disabled = true;
    const statusText = document.getElementById("exam-status");
    const statusDot = document.getElementById("exam-status-dot");
    if (statusText) statusText.textContent = "Â∑≤ÂÆåÊàê";
    if (statusDot) {
      statusDot.className = "status-dot completed";
    }
    Logger.info("Á≠îÈ¢òÂÆåÊàê");
  }
  async function startExam() {
    if (state.exam.isRunning) return;
    const aiConfig = getAIConfig();
    if (!aiConfig.apiKey || aiConfig.apiKey === "") {
      updateExamMessage("‚ùå ËØ∑ÂÖàÈÖçÁΩÆAPI Key", "#ef4444");
      return;
    }
    state.exam.isRunning = true;
    state.exam.currentQuestionIndex = 0;
    state.exam.totalQuestions = getTotalQuestions();
    document.getElementById("exam-start").disabled = true;
    document.getElementById("exam-stop").disabled = false;
    const statusText = document.getElementById("exam-status");
    const statusDot = document.getElementById("exam-status-dot");
    if (statusText) statusText.textContent = "ËøêË°å‰∏≠";
    if (statusDot) {
      statusDot.className = "status-dot running";
    }
    updateExamMessage(`ÂºÄÂßãAIÁ≠îÈ¢òÔºà‰ΩøÁî® ${AI_PRESETS[CONFIG.exam.currentAI].name}Ôºâ...`, "#10b981");
    updateExamProgress();
    await answerQuestions();
  }
  function stopExam() {
    state.exam.isRunning = false;
    document.getElementById("exam-start").disabled = false;
    document.getElementById("exam-stop").disabled = true;
    const statusText = document.getElementById("exam-status");
    const statusDot = document.getElementById("exam-status-dot");
    if (statusText) statusText.textContent = "Â∑≤ÂÅúÊ≠¢";
    if (statusDot) {
      statusDot.className = "status-dot";
    }
    updateExamMessage("Â∑≤ÂÅúÊ≠¢Á≠îÈ¢ò", "#f59e0b");
  }
  function getTotalQuestions() {
    const answerCard = document.querySelector(".topic-zpx-list");
    if (answerCard) {
      const questionSpans = answerCard.querySelectorAll(".topic-zpx-main span");
      return questionSpans.length;
    }
    return 0;
  }
  function updateExamProgress() {
    document.getElementById("exam-progress").textContent = `${state.exam.currentQuestionIndex}/${state.exam.totalQuestions}`;
    const percentage = state.exam.totalQuestions > 0 ? state.exam.currentQuestionIndex / state.exam.totalQuestions * 100 : 0;
    const progressBar = document.getElementById("exam-progress-bar");
    if (progressBar) {
      progressBar.style.width = `${percentage}%`;
      progressBar.setAttribute("data-progress", `${Math.round(percentage)}%`);
    }
  }
  function updateExamMessage(text, color = "#64748b") {
    const msg = document.getElementById("exam-message");
    if (msg) {
      msg.textContent = text;
      msg.style.color = color;
    }
  }
  function getPageType() {
    const url = window.location.href;
    if (url.includes("/excellent-study/")) {
      return "learning";
    } else if (url.includes("/preview-exam/")) {
      return "exam";
    }
    return "all";
  }
  function createPanel() {
    const panel = document.createElement("div");
    panel.id = "icve-tabbed-panel";
    const pageType = getPageType();
    const showLearning = pageType === "learning" || pageType === "all";
    const showExam = pageType === "exam" || pageType === "all";
    const defaultTab = pageType === "exam" ? "exam" : "learning";
    panel.innerHTML = `
        <div class="panel-container">
            <!-- Â§¥ÈÉ®ÔºöÊ†áÈ¢ò + ÊéßÂà∂ÊåâÈíÆ -->
            <div class="panel-header" id="panel-header">
                <span class="panel-title">üéì Êô∫ÊÖßËÅåÊïôÂÖ®ËÉΩÂä©Êâã</span>
                <div class="header-controls">
                    <button class="theme-toggle" id="theme-toggle" title="ÂàáÊç¢‰∏ªÈ¢ò">üåô</button>
                    <button class="panel-toggle" id="panel-toggle" title="ÊäòÂè†/Â±ïÂºÄ">‚àí</button>
                </div>
            </div>

            <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
            <div class="tab-nav">
                ${showLearning ? `<button class="tab-btn${defaultTab === "learning" ? " active" : ""}" data-tab="learning">üìö Â≠¶‰π†</button>` : ""}
                ${showExam ? `<button class="tab-btn${defaultTab === "exam" ? " active" : ""}" data-tab="exam">ü§ñ Á≠îÈ¢ò</button>` : ""}
                <button class="tab-btn" data-tab="log">üìã Êó•Âøó</button>
            </div>

            <!-- Ê†áÁ≠æÈ°µÂÜÖÂÆπ -->
            <div class="tab-content-wrapper" id="tab-content-wrapper">
                ${showLearning ? `<!-- Â≠¶‰π†Ê†áÁ≠æÈ°µ -->
                <div class="tab-pane${defaultTab === "learning" ? " active" : ""}" id="tab-learning">
                    ${createLearningTab()}
                </div>` : ""}

                ${showExam ? `<!-- Á≠îÈ¢òÊ†áÁ≠æÈ°µ -->
                <div class="tab-pane${defaultTab === "exam" ? " active" : ""}" id="tab-exam">
                    ${createExamTab()}
                </div>` : ""}

                <!-- Êó•ÂøóÊ†áÁ≠æÈ°µ -->
                <div class="tab-pane" id="tab-log">
                    ${createLogTab()}
                </div>
            </div>
        </div>
    `;
    addStyles();
    document.body.appendChild(panel);
    bindEvents();
    applyTheme(CONFIG.theme);
    restorePanelState();
    switchTab(defaultTab);
    loadLearningProgress();
  }
  function bindEvents() {
    const panel = document.getElementById("icve-tabbed-panel");
    if (!panel) return;
    makeDraggable();
    panel.addEventListener("click", Utils.debounce(handlePanelClick, 100));
    panel.addEventListener("change", Utils.throttle(handlePanelChange, 300));
    Logger.info("‰∫ã‰ª∂ÁªëÂÆöÂÆåÊàê");
  }
  function handlePanelClick(e) {
    var _a;
    const target = e.target;
    const id = target.id || ((_a = target.closest("[id]")) == null ? void 0 : _a.id);
    const actionMap = {
      "theme-toggle": toggleTheme,
      "panel-toggle": togglePanel,
      "learning-start": startLearning,
      "learning-scan": scanLearningNodes,
      "learning-reset": resetLearning,
      "exam-start": startExam,
      "exam-stop": stopExam,
      "clear-page-log": () => Logger.clearPageLog()
    };
    if (actionMap[id]) {
      actionMap[id]();
      return;
    }
    const tabBtn = target.closest(".tab-btn");
    if (tabBtn == null ? void 0 : tabBtn.dataset.tab) {
      switchTab(tabBtn.dataset.tab);
    }
  }
  function handlePanelChange(e) {
    const target = e.target;
    const id = target.id;
    const value = target.type === "checkbox" ? target.checked : target.value;
    switch (id) {
      case "learning-playback-rate":
        CONFIG.learning.playbackRate = parseFloat(value);
        applyPlaybackRate();
        saveConfig();
        Logger.info(`Êí≠ÊîæÂÄçÈÄü: ${CONFIG.learning.playbackRate}x`);
        break;
      case "learning-wait-time":
        CONFIG.learning.waitTimeAfterComplete = parseInt(value);
        saveConfig();
        Logger.info(`ÂÆåÊàêÁ≠âÂæÖÊó∂Èó¥: ${value}Áßí`);
        break;
      case "learning-doc-interval":
        CONFIG.learning.documentPageInterval = parseInt(value);
        saveConfig();
        Logger.info(`ÊñáÊ°£ÁøªÈ°µÈó¥Èöî: ${value}Áßí`);
        break;
      case "learning-expand-delay":
        CONFIG.learning.expandDelay = parseFloat(value);
        saveConfig();
        Logger.info(`Â±ïÂºÄÂª∂Ëøü: ${value}Áßí`);
        break;
      case "learning-mute-media":
        CONFIG.learning.muteMedia = value;
        applyMuteToCurrentMedia();
        saveConfig();
        const toggleIcon = document.querySelector(".btn-toggle-label .toggle-icon");
        if (toggleIcon) {
          toggleIcon.textContent = value ? "üîá" : "üîä";
        }
        Logger.info(`ÈùôÈü≥Ê®°Âºè: ${value ? "ÂºÄÂêØ" : "ÂÖ≥Èó≠"}`);
        break;
      case "exam-ai-model":
        CONFIG.exam.currentAI = value;
        const preset = AI_PRESETS[CONFIG.exam.currentAI];
        const aiConfig = getAIConfig();
        const apiKeyInput = document.getElementById("exam-api-key");
        const apiUrlInput = document.getElementById("exam-api-url");
        const modelInput = document.getElementById("exam-api-model-name");
        if (apiKeyInput) {
          apiKeyInput.value = aiConfig.apiKey;
          apiKeyInput.placeholder = preset.keyPlaceholder;
        }
        if (apiUrlInput) apiUrlInput.value = aiConfig.baseURL;
        if (modelInput) modelInput.value = aiConfig.model;
        updateExamMessage(`Â∑≤ÂàáÊç¢Âà∞ ${preset.name}`, "#10b981");
        setTimeout(() => {
          updateExamMessage(`Â∞±Áª™Ôºà‰ΩøÁî® ${preset.name}Ôºâ`, "#64748b");
        }, 2e3);
        saveConfig();
        Logger.info(`AIÊ®°Âûã: ${preset.name}`);
        break;
      case "exam-api-key":
        GM_setValue(`ai_key_${CONFIG.exam.currentAI}`, value.trim());
        updateExamMessage("API KeyÂ∑≤‰øùÂ≠ò", "#10b981");
        setTimeout(() => {
          updateExamMessage(`Â∞±Áª™Ôºà‰ΩøÁî® ${AI_PRESETS[CONFIG.exam.currentAI].name}Ôºâ`, "#64748b");
        }, 2e3);
        Logger.info("API KeyÂ∑≤Êõ¥Êñ∞");
        break;
      case "exam-api-url":
        GM_setValue(`ai_baseurl_${CONFIG.exam.currentAI}`, value.trim());
        updateExamMessage("APIÂú∞ÂùÄÂ∑≤‰øùÂ≠ò", "#10b981");
        setTimeout(() => {
          updateExamMessage(`Â∞±Áª™Ôºà‰ΩøÁî® ${AI_PRESETS[CONFIG.exam.currentAI].name}Ôºâ`, "#64748b");
        }, 2e3);
        Logger.info(`APIÂú∞ÂùÄÂ∑≤Êõ¥Êñ∞`);
        break;
      case "exam-api-model-name":
        GM_setValue(`ai_model_${CONFIG.exam.currentAI}`, value.trim());
        updateExamMessage("Ê®°ÂûãÂêçÁß∞Â∑≤‰øùÂ≠ò", "#10b981");
        setTimeout(() => {
          updateExamMessage(`Â∞±Áª™Ôºà‰ΩøÁî® ${AI_PRESETS[CONFIG.exam.currentAI].name}Ôºâ`, "#64748b");
        }, 2e3);
        Logger.info(`Ê®°ÂûãÂêçÁß∞: ${value.trim()}`);
        break;
      case "exam-delay":
        CONFIG.exam.delay = parseInt(value) * 1e3;
        saveConfig();
        Logger.info(`Á≠îÈ¢òÈó¥Èöî: ${value}Áßí`);
        break;
      case "exam-auto-submit":
        CONFIG.exam.autoSubmit = value;
        saveConfig();
        Logger.info(`Ëá™Âä®‰∫§Âç∑: ${value ? "ÂºÄÂêØ" : "ÂÖ≥Èó≠"}`);
        break;
    }
  }
  function switchTab(tabName) {
    var _a, _b;
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.classList.remove("active");
    });
    (_a = document.querySelector(`[data-tab="${tabName}"]`)) == null ? void 0 : _a.classList.add("active");
    document.querySelectorAll(".tab-pane").forEach((pane) => {
      pane.classList.remove("active");
    });
    (_b = document.getElementById(`tab-${tabName}`)) == null ? void 0 : _b.classList.add("active");
    CONFIG.currentTab = tabName;
    saveConfig();
  }
  function toggleTheme() {
    CONFIG.theme = CONFIG.theme === "light" ? "dark" : "light";
    applyTheme(CONFIG.theme);
    saveConfig();
  }
  function applyTheme(theme) {
    const panel = document.getElementById("icve-tabbed-panel");
    const themeBtn = document.getElementById("theme-toggle");
    if (panel) {
      if (theme === "dark") {
        panel.classList.add("dark-theme");
      } else {
        panel.classList.remove("dark-theme");
      }
    }
    if (themeBtn) {
      themeBtn.textContent = theme === "dark" ? "‚òÄÔ∏è" : "üåô";
      themeBtn.title = theme === "dark" ? "ÂàáÊç¢Âà∞ÊµÖËâ≤Ê®°Âºè" : "ÂàáÊç¢Âà∞Ê∑±Ëâ≤Ê®°Âºè";
    }
  }
  function togglePanel() {
    const wrapper = document.getElementById("tab-content-wrapper");
    const tabNav = document.querySelector(".tab-nav");
    const toggleBtn = document.getElementById("panel-toggle");
    if (wrapper.classList.contains("collapsed")) {
      wrapper.classList.remove("collapsed");
      if (tabNav) tabNav.classList.remove("collapsed");
      toggleBtn.textContent = "‚àí";
      localStorage.setItem("icve_panel_collapsed", "false");
    } else {
      wrapper.classList.add("collapsed");
      if (tabNav) tabNav.classList.add("collapsed");
      toggleBtn.textContent = "+";
      localStorage.setItem("icve_panel_collapsed", "true");
    }
  }
  function restorePanelState() {
    const isCollapsed = localStorage.getItem("icve_panel_collapsed") === "true";
    if (isCollapsed) {
      const wrapper = document.getElementById("tab-content-wrapper");
      const tabNav = document.querySelector(".tab-nav");
      const toggleBtn = document.getElementById("panel-toggle");
      if (wrapper) wrapper.classList.add("collapsed");
      if (tabNav) tabNav.classList.add("collapsed");
      if (toggleBtn) toggleBtn.textContent = "+";
    }
  }
  function makeDraggable() {
    const panel = document.getElementById("icve-tabbed-panel");
    const header = document.getElementById("panel-header");
    let isDragging = false;
    let currentX, currentY, initialX, initialY;
    header.addEventListener("mousedown", (e) => {
      initialX = e.clientX - panel.offsetLeft;
      initialY = e.clientY - panel.offsetTop;
      isDragging = true;
    });
    document.addEventListener("mousemove", (e) => {
      if (isDragging) {
        e.preventDefault();
        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;
        panel.style.left = currentX + "px";
        panel.style.top = currentY + "px";
        panel.style.right = "auto";
      }
    });
    document.addEventListener("mouseup", () => {
      isDragging = false;
    });
  }
  window.updateLogCount = function() {
    const logCountElement = document.getElementById("log-count");
    if (logCountElement) {
      logCountElement.textContent = `${Logger._logs.length} Êù°ËÆ∞ÂΩï`;
    }
  };
  function init() {
    createPanel();
    Logger.info("Êô∫ÊÖßËÅåÊïôÂÖ®ËÉΩÂä©ÊâãÂ∑≤Âä†ËΩΩ");
  }
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(init, 1e3);
    });
  } else {
    setTimeout(init, 1e3);
  }

})();